var Controller=pc.createScript("controller");function getRandom(t,s){return Math.random()*(s-t)+t}Controller.attributes.add("ballPrefab",{type:"asset"}),Controller.attributes.add("useInstancing",{type:"boolean"}),Controller.attributes.add("instShape",{type:"asset"}),Controller.attributes.add("positionWidth",{type:"number"}),Controller.attributes.add("positionHeight",{type:"number"}),Controller.attributes.add("countEntity",{type:"entity"}),Controller.attributes.add("ballMaterial",{type:"asset"}),Controller.prototype.initialize=function(){if(this.objects=[],this.objectsData=[],this.totalCount=0,this.g=-9.8,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.instObj=null,this.mtx=null,this.useInstancing){var t=this.ballPrefab.resource.instantiate();this.entity.addChild(t),this.instObj=t.children[0].model.meshInstances[0];var s=this.ballMaterial.resource;s.onUpdateShader=function(t){return t.useInstancing=!0,t},s.update(),t.children[0].model.material=s;for(var e=t.children[0].model.meshInstances,i=0;i<e.length;++i)e[i].material=s;this.matrices=new Float32Array(0),this.vertexBuffer=new pc.VertexBuffer(this.app.graphicsDevice,pc.VertexFormat.defaultInstancingFormat,0,pc.BUFFER_DYNAMIC,this.matrices),this.instObj.setInstancing(this.vertexBuffer)}},Controller.prototype.onMouseDown=function(t){var s=Math.floor(this.totalCount/2)+1;if(this.useInstancing){for(var e=0;e<s;e++){var i=getRandom(.25,1);this.objectsData.push({x:getRandom(-this.positionWidth,this.positionWidth),y:getRandom(this.positionHeight/4,this.positionHeight),z:getRandom(-this.positionWidth,this.positionWidth),s:.3*i,v:0})}this.matrices=new Float32Array(16*(this.totalCount+s)),this.vertexBuffer.destroy(),this.vertexBuffer=new pc.VertexBuffer(this.app.graphicsDevice,pc.VertexFormat.defaultInstancingFormat,this.totalCount+s,pc.BUFFER_DYNAMIC,this.matrices),this.instObj.setInstancing(this.vertexBuffer)}else for(e=0;e<s;e++){var a=this.ballPrefab.resource.instantiate();this.entity.addChild(a),this.objects.push(a);i=getRandom(.25,1);this.objectsData.push({x:getRandom(-this.positionWidth,this.positionWidth),y:getRandom(this.positionHeight/4,this.positionHeight),z:getRandom(-this.positionWidth,this.positionWidth),s:i,v:0}),a.setLocalScale(i,i,i)}this.totalCount=this.totalCount+s,this.countEntity.element.text=this.totalCount.toString()},Controller.prototype.update=function(t){if(this.useInstancing){for(var s=new pc.Mat4,e=new pc.Vec3,i=new pc.Quat,a=new pc.Vec3,o=0,n=0;n<this.objectsData.length;n++){this.objectsData[n].v+=this.g*t,this.objectsData[n].y+=this.objectsData[n].v*t,this.objectsData[n].y<0&&(this.objectsData[n].v*=-1,this.objectsData[n].y*=-1),e.set(this.objectsData[n].x,this.objectsData[n].y+this.objectsData[n].s,this.objectsData[n].z),i.setFromEulerAngles(0,0,0),a.set(this.objectsData[n].s,this.objectsData[n].s,this.objectsData[n].s),s.setTRS(e,i,a);for(var h=0;h<16;h++)this.matrices[o++]=s.data[h]}this.vertexBuffer.setData(this.matrices)}else for(n=0;n<this.objectsData.length;n++)this.objectsData[n].v+=this.g*t,this.objectsData[n].y+=this.objectsData[n].v*t,this.objectsData[n].y<0&&(this.objectsData[n].v*=-1,this.objectsData[n].y*=-1),this.objects[n].setPosition(this.objectsData[n].x,this.objectsData[n].y,this.objectsData[n].z)};var FpsCounter=pc.createScript("fpsCounter");FpsCounter.attributes.add("fpsEntity",{type:"entity"}),FpsCounter.prototype.initialize=function(){this.lastFPSUpdate=0,this.fpsAccumulator=0,this.fpsSteps=0},FpsCounter.prototype.update=function(t){var s=Date.now();s-this.lastFPSUpdate>1e3&&(this.fpsEntity.element.text=(this.fpsSteps/this.fpsAccumulator).toString(),this.lastFPSUpdate=s,this.fpsAccumulator=0,this.fpsSteps=0),this.fpsAccumulator+=t,this.fpsSteps+=1};