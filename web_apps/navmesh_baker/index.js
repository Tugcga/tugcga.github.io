(()=>{var t,e,r,s,i={750:function(t,e,r){var s,i;void 0===(i="function"==typeof(s=function(){"use strict";var e="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0;function s(t,e,r){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="blob",s.onload=function(){o(s.response,e,r)},s.onerror=function(){console.error("could not download file")},s.send()}function i(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return e.status>=200&&e.status<=299}function n(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(r){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=e.saveAs||("object"!=typeof window||window!==e?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(t,r,a){var o=e.URL||e.webkitURL,h=document.createElement("a");r=r||t.name||"download",h.download=r,h.rel="noopener","string"==typeof t?(h.href=t,h.origin!==location.origin?i(h.href)?s(t,r,a):n(h,h.target="_blank"):n(h)):(h.href=o.createObjectURL(t),setTimeout((function(){o.revokeObjectURL(h.href)}),4e4),setTimeout((function(){n(h)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,e,r){if(e=e||t.name||"download","string"==typeof t)if(i(t))s(t,e,r);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout((function(){n(a)}))}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,r),e)}:function(t,r,i,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof t)return s(t,r,i);var o="application/octet-stream"===t.type,h=/constructor/i.test(e.HTMLElement)||e.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||o&&h||a)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var t=l.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=t:location=t,n=null},l.readAsDataURL(t)}else{var c=e.URL||e.webkitURL,d=c.createObjectURL(t);n?n.location=d:location.href=d,n=null,setTimeout((function(){c.revokeObjectURL(d)}),4e4)}});e.saveAs=o.saveAs=o,t.exports=o})?s.apply(e,[]):s)||(t.exports=i)},368:(t,e,r)=>{"use strict";function s(t){let e=t[0],r=t[1],s=t[2];return Math.sqrt(e*e+r*r+s*s)}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function n(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function a(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function o(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function h(t){let e=t[0],r=t[1],s=t[2];return e*e+r*r+s*s}function u(t,e){let r=e[0],s=e[1],i=e[2],n=r*r+s*s+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function l(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function c(t,e,r){let s=e[0],i=e[1],n=e[2],a=r[0],o=r[1],h=r[2];return t[0]=i*h-n*o,t[1]=n*a-s*h,t[2]=s*o-i*a,t}r.d(e,{V1:()=>D,Il:()=>H,ZX:()=>w,Kj:()=>G,qZ:()=>ot,aH:()=>wt,$r:()=>x,Th:()=>C,wx:()=>k,AO:()=>p});const d=function(){const t=[0,0,0],e=[0,0,0];return function(r,s){i(t,r),i(e,s),u(t,t),u(e,e);let n=l(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}();class p extends Array{constructor(t=0,e=t,r=t){return super(t,e,r),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,r=t){return t.length?this.copy(t):(function(t,e,r,s){t[0]=e,t[1]=r,t[2]=s}(this,t,e,r),this)}copy(t){return i(this,t),this}add(t,e){return e?n(this,t,e):n(this,this,t),this}sub(t,e){return e?a(this,t,e):a(this,this,t),this}multiply(t){var e,r,s;return t.length?(r=this,s=t,(e=this)[0]=r[0]*s[0],e[1]=r[1]*s[1],e[2]=r[2]*s[2]):o(this,this,t),this}divide(t){var e,r,s;return t.length?(r=this,s=t,(e=this)[0]=r[0]/s[0],e[1]=r[1]/s[1],e[2]=r[2]/s[2]):o(this,this,1/t),this}inverse(t=this){var e,r;return r=t,(e=this)[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],this}len(){return s(this)}distance(t){return t?function(t,e){let r=e[0]-t[0],s=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+s*s+i*i)}(this,t):s(this)}squaredLen(){return h(this)}squaredDistance(t){return t?function(t,e){let r=e[0]-t[0],s=e[1]-t[1],i=e[2]-t[2];return r*r+s*s+i*i}(this,t):h(this)}negate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],e[2]=-r[2],this}cross(t,e){return e?c(this,t,e):c(this,this,t),this}scale(t){return o(this,this,t),this}normalize(){return u(this,this),this}dot(t){return l(this,t)}equals(t){return e=t,this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2];var e}applyMatrix4(t){return function(t,e,r){let s=e[0],i=e[1],n=e[2],a=r[3]*s+r[7]*i+r[11]*n+r[15];a=a||1,t[0]=(r[0]*s+r[4]*i+r[8]*n+r[12])/a,t[1]=(r[1]*s+r[5]*i+r[9]*n+r[13])/a,t[2]=(r[2]*s+r[6]*i+r[10]*n+r[14])/a}(this,this,t),this}scaleRotateMatrix4(t){return function(t,e,r){let s=e[0],i=e[1],n=e[2],a=r[3]*s+r[7]*i+r[11]*n+r[15];a=a||1,t[0]=(r[0]*s+r[4]*i+r[8]*n)/a,t[1]=(r[1]*s+r[5]*i+r[9]*n)/a,t[2]=(r[2]*s+r[6]*i+r[10]*n)/a}(this,this,t),this}applyQuaternion(t){return function(t,e,r){let s=e[0],i=e[1],n=e[2],a=r[0],o=r[1],h=r[2],u=o*n-h*i,l=h*s-a*n,c=a*i-o*s,d=o*c-h*l,p=h*u-a*c,g=a*l-o*u,f=2*r[3];u*=f,l*=f,c*=f,d*=2,p*=2,g*=2,t[0]=s+u+d,t[1]=i+l+p,t[2]=n+c+g}(this,this,t),this}angle(t){return d(this,t)}lerp(t,e){return function(t,e,r,s){let i=e[0],n=e[1],a=e[2];t[0]=i+s*(r[0]-i),t[1]=n+s*(r[1]-n),t[2]=a+s*(r[2]-a)}(this,this,t,e),this}clone(){return new p(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){const e=this[0],r=this[1],s=this[2];return this[0]=t[0]*e+t[4]*r+t[8]*s,this[1]=t[1]*e+t[5]*r+t[9]*s,this[2]=t[2]*e+t[6]*r+t[10]*s,this.normalize()}}const g=new p;let f=1,m=1,v=!1;class w{constructor(t,e={}){this.isInstanced=!1,this.raycast="box",t.canvas||console.error("gl not passed as fist argument to Geometry"),this.gl=t,this.attributes=e,this.id=f++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let t in e)this.addAttribute(t,e[t])}addAttribute(t,e){if(this.attributes[t]=e,e.id=m++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:e,type:r})=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const s=this.attributes[e];this.gl.bindBuffer(s.target,s.buffer),this.glState.boundBuffer=s.buffer;let i=1;35674===r&&(i=2),35675===r&&(i=3),35676===r&&(i=4);const n=s.size/i,a=1===i?0:i*i*i,o=1===i?0:i*i;for(let e=0;e<i;e++)this.gl.vertexAttribPointer(t+e,n,s.type,s.normalized,s.stride+a,s.offset+e*o),this.gl.enableVertexAttribArray(t+e),this.gl.renderer.vertexAttribDivisor(t+e,s.divisor)})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach(((t,{name:e})=>{const r=this.attributes[e];r.needsUpdate&&this.updateAttribute(r)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}getPosition(){const t=this.attributes.position;return t.data?t:v?void 0:(console.warn("No position buffer data found to compute bounds"),v=!0)}computeBoundingBox(t=null){t||(t=this.getPosition());const e=t.data,r=t.offset||0,s=t.stride||t.size;this.bounds||(this.bounds={min:new p,max:new p,center:new p,scale:new p,radius:1/0});const i=this.bounds.min,n=this.bounds.max,a=this.bounds.center,o=this.bounds.scale;i.set(1/0),n.set(-1/0);for(let t=r,a=e.length;t<a;t+=s){const r=e[t],s=e[t+1],a=e[t+2];i.x=Math.min(r,i.x),i.y=Math.min(s,i.y),i.z=Math.min(a,i.z),n.x=Math.max(r,n.x),n.y=Math.max(s,n.y),n.z=Math.max(a,n.z)}o.sub(n,i),a.add(i,n).divide(2)}computeBoundingSphere(t=null){t||(t=this.getPosition());const e=t.data,r=t.offset||0,s=t.stride||t.size;this.bounds||this.computeBoundingBox(t);let i=0;for(let t=r,n=e.length;t<n;t+=s)g.fromArray(e,t),i=Math.max(i,this.bounds.center.squaredDistance(g));this.bounds.radius=Math.sqrt(i)}computeVertexNormals(){const t=this.attributes.position;if(!t)return;let e=this.attributes.normal;e?e.data.fill(0):(this.addAttribute("normal",{size:3,data:new Float32Array(3*t.count)}),e=this.attributes.normal);const r=new p,s=new p,i=new p,n=new p,a=new p,o=new p,h=new p,u=new p,l=this.attributes.index;if(l){let c,d,p;for(let g=0,f=l.count;g<f;g+=3)c=l.data[g],d=l.data[g+1],p=l.data[g+2],r.fromArray(t.data,c*t.size),s.fromArray(t.data,d*t.size),i.fromArray(t.data,p*t.size),h.sub(i,s),u.sub(r,s),h.cross(u),n.fromArray(e.data,c*e.size),a.fromArray(e.data,d*e.size),o.fromArray(e.data,p*e.size),n.add(h),a.add(h),o.add(h),c*=e.size,e.data[c]=n.x,e.data[c+1]=n.y,e.data[c+2]=n.z,d*=e.size,e.data[d]=a.x,e.data[d+1]=a.y,e.data[d+2]=a.z,p*=e.size,e.data[p]=o.x,e.data[p+1]=o.y,e.data[p+2]=o.z}else for(let n=0,a=t.count;n<a;n+=3)r.fromArray(t.data,n*t.size),s.fromArray(t.data,(n+1)*t.size),i.fromArray(t.data,(n+2)*t.size),h.sub(i,s),u.sub(r,s),h.cross(u),e.data[n*e.size]=h.x,e.data[n*e.size+1]=h.y,e.data[n*e.size+2]=h.z,e.data[(n+1)*e.size]=h.x,e.data[(n+1)*e.size+1]=h.y,e.data[(n+1)*e.size+2]=h.z,e.data[(n+2)*e.size]=h.x,e.data[(n+2)*e.size+1]=h.y,e.data[(n+2)*e.size+2]=h.z;this.normalizeNormals(),e.needsUpdate=!0}normalizeNormals(){const t=this.attributes.normal;for(let e=0,r=t.count;e<r;e++)g.fromArray(t.data,e*t.size),g.normalize(),t.data[e*t.size]=g.x,t.data[e*t.size+1]=g.y,t.data[e*t.size+2]=g.z}remove(){for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}let y=1;const b={};class x{constructor(t,{vertex:e,fragment:r,uniforms:s={},transparent:i=!1,cullFace:n=t.BACK,frontFace:a=t.CCW,depthTest:o=!0,depthWrite:h=!0,depthFunc:u=t.LESS}={}){t.canvas||console.error("gl not passed as fist argument to Program"),this.gl=t,this.uniforms=s,this.id=y++,e||console.warn("vertex shader not supplied"),r||console.warn("fragment shader not supplied"),this.transparent=i,this.cullFace=n,this.frontFace=a,this.depthTest=o,this.depthWrite=h,this.depthFunc=u,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const l=t.createShader(t.VERTEX_SHADER);t.shaderSource(l,e),t.compileShader(l),""!==t.getShaderInfoLog(l)&&console.warn(`${t.getShaderInfoLog(l)}\nVertex Shader\n${A(e)}`);const c=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(c,r),t.compileShader(c),""!==t.getShaderInfoLog(c)&&console.warn(`${t.getShaderInfoLog(c)}\nFragment Shader\n${A(r)}`),this.program=t.createProgram(),t.attachShader(this.program,l),t.attachShader(this.program,c),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return void console.warn(t.getProgramInfoLog(this.program));t.deleteShader(l),t.deleteShader(c),this.uniformLocations=new Map;let d=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<d;e++){let r=t.getActiveUniform(this.program,e);this.uniformLocations.set(r,t.getUniformLocation(this.program,r.name));const s=r.name.match(/(\w+)/g);r.uniformName=s[0],3===s.length?(r.isStructArray=!0,r.structIndex=Number(s[1]),r.structProperty=s[2]):2===s.length&&isNaN(Number(s[1]))&&(r.isStruct=!0,r.structProperty=s[1])}this.attributeLocations=new Map;const p=[],g=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<g;e++){const r=t.getActiveAttrib(this.program,e),s=t.getAttribLocation(this.program,r.name);p[s]=r.name,this.attributeLocations.set(r,s)}this.attributeOrder=p.join("")}setBlendFunc(t,e,r,s){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=r,this.blendFunc.dstAlpha=s,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach(((t,r)=>{let s=r.uniformName,i=this.uniforms[s];if(r.isStruct&&(i=i[r.structProperty],s+=`.${r.structProperty}`),r.isStructArray&&(i=i[r.structIndex][r.structProperty],s+=`[${r.structIndex}].${r.structProperty}`),!i)return E(`Active uniform ${s} has not been supplied`);if(i&&void 0===i.value)return E(`${s} uniform is missing a value parameter`);if(i.value.texture)return e+=1,i.value.update(e),M(this.gl,r.type,t,e);if(i.value.length&&i.value[0].texture){const s=[];return i.value.forEach((t=>{e+=1,t.update(e),s.push(e)})),M(this.gl,r.type,t,s)}M(this.gl,r.type,t,i.value)})),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function M(t,e,r,s){s=s.length?function(t){const e=t.length,r=t[0].length;if(void 0===r)return t;const s=e*r;let i=b[s];i||(b[s]=i=new Float32Array(s));for(let s=0;s<e;s++)i.set(t[s],s*r);return i}(s):s;const i=t.renderer.state.uniformLocations.get(r);if(s.length)if(void 0===i||i.length!==s.length)t.renderer.state.uniformLocations.set(r,s.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let r=0,s=t.length;r<s;r++)if(t[r]!==e[r])return!1;return!0}(i,s))return;i.set?i.set(s):function(t,e){for(let r=0,s=t.length;r<s;r++)t[r]=e[r]}(i,s),t.renderer.state.uniformLocations.set(r,i)}else{if(i===s)return;t.renderer.state.uniformLocations.set(r,s)}switch(e){case 5126:return s.length?t.uniform1fv(r,s):t.uniform1f(r,s);case 35664:return t.uniform2fv(r,s);case 35665:return t.uniform3fv(r,s);case 35666:return t.uniform4fv(r,s);case 35670:case 5124:case 35678:case 35680:return s.length?t.uniform1iv(r,s):t.uniform1i(r,s);case 35671:case 35667:return t.uniform2iv(r,s);case 35672:case 35668:return t.uniform3iv(r,s);case 35673:case 35669:return t.uniform4iv(r,s);case 35674:return t.uniformMatrix2fv(r,!1,s);case 35675:return t.uniformMatrix3fv(r,!1,s);case 35676:return t.uniformMatrix4fv(r,!1,s)}}function A(t){let e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}let _=0;function E(t){_>100||(console.warn(t),_++,_>100&&console.warn("More than 100 program warnings - stopping logs."))}const z=new p;let F=1;class C{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:r=150,dpr:s=1,alpha:i=!1,depth:n=!0,stencil:a=!1,antialias:o=!1,premultipliedAlpha:h=!1,preserveDrawingBuffer:u=!1,powerPreference:l="default",autoClear:c=!0,webgl:d=2}={}){const p={alpha:i,depth:n,stencil:a,antialias:o,premultipliedAlpha:h,preserveDrawingBuffer:u,powerPreference:l};this.dpr=s,this.alpha=i,this.color=!0,this.depth=n,this.stencil=a,this.premultipliedAlpha=h,this.autoClear=c,this._id=F++,2===d&&(this.gl=t.getContext("webgl2",p)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",p)||t.getContext("experimental-webgl",p)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(e,r),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}get id(){return this._id}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,r,s){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===r&&this.state.blendFunc.dstAlpha===s||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=r,this.state.blendFunc.dstAlpha=s,void 0!==r?this.gl.blendFuncSeparate(t,e,r,s):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,r){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][r].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:r,sort:s}){let i=[];if(e&&r&&e.updateFrustum(),t.traverse((t=>{if(!t.visible)return!0;(t=>!!t.draw)(t)&&(r&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t)||i.push(t))})),s){const t=[],r=[],s=[];i.forEach((i=>{i.program.transparent?i.program.depthTest?r.push(i):s.push(i):t.push(i),i.zDepth=0,0===i.renderOrder&&i.program.depthTest&&e&&(i.worldMatrix.getTranslation(z),z.applyMatrix4(e.projectionViewMatrix),i.zDepth=z.z)})),t.sort(this.sortOpaque),r.sort(this.sortTransparent),s.sort(this.sortUI),i=t.concat(r,s)}return i}render({scene:t,camera:e,target:r=null,update:s=!0,sort:i=!0,frustumCull:n=!0,clear:a}){null===r?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(r),this.setViewport(r.width,r.height)),(a||this.autoClear&&!1!==a)&&(!this.depth||r&&!r.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),s&&t.updateMatrixWorld(),e&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:n,sort:i}).forEach((t=>{t.draw({camera:e})}))}}function S(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],p=e[10],g=e[11],f=e[12],m=e[13],v=e[14],w=e[15],y=r[0],b=r[1],x=r[2],M=r[3];return t[0]=y*s+b*o+x*c+M*f,t[1]=y*i+b*h+x*d+M*m,t[2]=y*n+b*u+x*p+M*v,t[3]=y*a+b*l+x*g+M*w,y=r[4],b=r[5],x=r[6],M=r[7],t[4]=y*s+b*o+x*c+M*f,t[5]=y*i+b*h+x*d+M*m,t[6]=y*n+b*u+x*p+M*v,t[7]=y*a+b*l+x*g+M*w,y=r[8],b=r[9],x=r[10],M=r[11],t[8]=y*s+b*o+x*c+M*f,t[9]=y*i+b*h+x*d+M*m,t[10]=y*n+b*u+x*p+M*v,t[11]=y*a+b*l+x*g+M*w,y=r[12],b=r[13],x=r[14],M=r[15],t[12]=y*s+b*o+x*c+M*f,t[13]=y*i+b*h+x*d+M*m,t[14]=y*n+b*u+x*p+M*v,t[15]=y*a+b*l+x*g+M*w,t}function R(t,e){let r=e[0],s=e[1],i=e[2],n=e[4],a=e[5],o=e[6],h=e[8],u=e[9],l=e[10];return t[0]=Math.hypot(r,s,i),t[1]=Math.hypot(n,a,o),t[2]=Math.hypot(h,u,l),t}const L=function(){const t=[0,0,0];return function(e,r){let s=t;R(s,r);let i=1/s[0],n=1/s[1],a=1/s[2],o=r[0]*i,h=r[1]*n,u=r[2]*a,l=r[4]*i,c=r[5]*n,d=r[6]*a,p=r[8]*i,g=r[9]*n,f=r[10]*a,m=o+c+f,v=0;return m>0?(v=2*Math.sqrt(m+1),e[3]=.25*v,e[0]=(d-g)/v,e[1]=(p-u)/v,e[2]=(h-l)/v):o>c&&o>f?(v=2*Math.sqrt(1+o-c-f),e[3]=(d-g)/v,e[0]=.25*v,e[1]=(h+l)/v,e[2]=(p+u)/v):c>f?(v=2*Math.sqrt(1+c-o-f),e[3]=(p-u)/v,e[0]=(h+l)/v,e[1]=.25*v,e[2]=(d+g)/v):(v=2*Math.sqrt(1+f-o-c),e[3]=(h-l)/v,e[0]=(p+u)/v,e[1]=(d+g)/v,e[2]=.25*v),e}}();class O extends Array{constructor(t=1,e=0,r=0,s=0,i=0,n=1,a=0,o=0,h=0,u=0,l=1,c=0,d=0,p=0,g=0,f=1){return super(t,e,r,s,i,n,a,o,h,u,l,c,d,p,g,f),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,r,s,i,n,a,o,h,u,l,c,d,p,g,f){return t.length?this.copy(t):(function(t,e,r,s,i,n,a,o,h,u,l,c,d,p,g,f,m){t[0]=e,t[1]=r,t[2]=s,t[3]=i,t[4]=n,t[5]=a,t[6]=o,t[7]=h,t[8]=u,t[9]=l,t[10]=c,t[11]=d,t[12]=p,t[13]=g,t[14]=f,t[15]=m}(this,t,e,r,s,i,n,a,o,h,u,l,c,d,p,g,f),this)}translate(t,e=this){return function(t,e,r){let s,i,n,a,o,h,u,l,c,d,p,g,f=r[0],m=r[1],v=r[2];e===t?(t[12]=e[0]*f+e[4]*m+e[8]*v+e[12],t[13]=e[1]*f+e[5]*m+e[9]*v+e[13],t[14]=e[2]*f+e[6]*m+e[10]*v+e[14],t[15]=e[3]*f+e[7]*m+e[11]*v+e[15]):(s=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],p=e[10],g=e[11],t[0]=s,t[1]=i,t[2]=n,t[3]=a,t[4]=o,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=d,t[10]=p,t[11]=g,t[12]=s*f+o*m+c*v+e[12],t[13]=i*f+h*m+d*v+e[13],t[14]=n*f+u*m+p*v+e[14],t[15]=a*f+l*m+g*v+e[15])}(this,e,t),this}rotate(t,e,r=this){return function(t,e,r,s){let i,n,a,o,h,u,l,c,d,p,g,f,m,v,w,y,b,x,M,A,_,E,z,F,C=s[0],S=s[1],R=s[2],L=Math.hypot(C,S,R);Math.abs(L)<1e-6||(L=1/L,C*=L,S*=L,R*=L,i=Math.sin(r),n=Math.cos(r),a=1-n,o=e[0],h=e[1],u=e[2],l=e[3],c=e[4],d=e[5],p=e[6],g=e[7],f=e[8],m=e[9],v=e[10],w=e[11],y=C*C*a+n,b=S*C*a+R*i,x=R*C*a-S*i,M=C*S*a-R*i,A=S*S*a+n,_=R*S*a+C*i,E=C*R*a+S*i,z=S*R*a-C*i,F=R*R*a+n,t[0]=o*y+c*b+f*x,t[1]=h*y+d*b+m*x,t[2]=u*y+p*b+v*x,t[3]=l*y+g*b+w*x,t[4]=o*M+c*A+f*_,t[5]=h*M+d*A+m*_,t[6]=u*M+p*A+v*_,t[7]=l*M+g*A+w*_,t[8]=o*E+c*z+f*F,t[9]=h*E+d*z+m*F,t[10]=u*E+p*z+v*F,t[11]=l*E+g*z+w*F,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,r,t,e),this}scale(t,e=this){return function(t,e,r){let s=r[0],i=r[1],n=r[2];t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this,e,"number"==typeof t?[t,t,t]:t),this}multiply(t,e){return e?S(this,t,e):S(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}fromPerspective({fov:t,aspect:e,near:r,far:s}={}){return function(t,e,r,s,i){let n=1/Math.tan(e/2),a=1/(s-i);t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+s)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*s*a,t[15]=0}(this,t,e,r,s),this}fromOrthogonal({left:t,right:e,bottom:r,top:s,near:i,far:n}){return function(t,e,r,s,i,n,a){let o=1/(e-r),h=1/(s-i),u=1/(n-a);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(i+s)*h,t[14]=(a+n)*u,t[15]=1}(this,t,e,r,s,i,n),this}fromQuaternion(t){return function(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=r+r,o=s+s,h=i+i,u=r*a,l=s*a,c=s*o,d=i*a,p=i*o,g=i*h,f=n*a,m=n*o,v=n*h;t[0]=1-c-g,t[1]=l+v,t[2]=d-m,t[3]=0,t[4]=l-v,t[5]=1-u-g,t[6]=p+f,t[7]=0,t[8]=d+m,t[9]=p-f,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){return function(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],p=e[11],g=e[12],f=e[13],m=e[14],v=e[15],w=r*o-s*a,y=r*h-i*a,b=r*u-n*a,x=s*h-i*o,M=s*u-n*o,A=i*u-n*h,_=l*f-c*g,E=l*m-d*g,z=l*v-p*g,F=c*m-d*f,C=c*v-p*f,S=d*v-p*m,R=w*S-y*C+b*F+x*z-M*E+A*_;R&&(R=1/R,t[0]=(o*S-h*C+u*F)*R,t[1]=(i*C-s*S-n*F)*R,t[2]=(f*A-m*M+v*x)*R,t[3]=(d*M-c*A-p*x)*R,t[4]=(h*z-a*S-u*E)*R,t[5]=(r*S-i*z+n*E)*R,t[6]=(m*b-g*A-v*y)*R,t[7]=(l*A-d*b+p*y)*R,t[8]=(a*C-o*z+u*_)*R,t[9]=(s*z-r*C-n*_)*R,t[10]=(g*M-f*b+v*w)*R,t[11]=(c*b-l*M-p*w)*R,t[12]=(o*E-a*F-h*_)*R,t[13]=(r*F-s*E+i*_)*R,t[14]=(f*y-g*x-m*w)*R,t[15]=(l*x-c*y+d*w)*R)}(this,t),this}compose(t,e,r){return function(t,e,r,s){let i=e[0],n=e[1],a=e[2],o=e[3],h=i+i,u=n+n,l=a+a,c=i*h,d=i*u,p=i*l,g=n*u,f=n*l,m=a*l,v=o*h,w=o*u,y=o*l,b=s[0],x=s[1],M=s[2];t[0]=(1-(g+m))*b,t[1]=(d+y)*b,t[2]=(p-w)*b,t[3]=0,t[4]=(d-y)*x,t[5]=(1-(c+m))*x,t[6]=(f+v)*x,t[7]=0,t[8]=(p+w)*M,t[9]=(f-v)*M,t[10]=(1-(c+g))*M,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1}(this,t,e,r),this}getRotation(t){return L(t,this),this}getTranslation(t){var e,r;return r=this,(e=t)[0]=r[12],e[1]=r[13],e[2]=r[14],this}getScaling(t){return R(t,this),this}getMaxScaleOnAxis(){return function(t){let e=t[0],r=t[1],s=t[2],i=t[4],n=t[5],a=t[6],o=t[8],h=t[9],u=t[10];const l=e*e+r*r+s*s,c=i*i+n*n+a*a,d=o*o+h*h+u*u;return Math.sqrt(Math.max(l,c,d))}(this)}lookAt(t,e,r){return function(t,e,r,s){let i=e[0],n=e[1],a=e[2],o=s[0],h=s[1],u=s[2],l=i-r[0],c=n-r[1],d=a-r[2],p=l*l+c*c+d*d;0===p?d=1:(p=1/Math.sqrt(p),l*=p,c*=p,d*=p);let g=h*d-u*c,f=u*l-o*d,m=o*c-h*l;p=g*g+f*f+m*m,0===p&&(u?o+=1e-6:h?u+=1e-6:h+=1e-6,g=h*d-u*c,f=u*l-o*d,m=o*c-h*l,p=g*g+f*f+m*m),p=1/Math.sqrt(p),g*=p,f*=p,m*=p,t[0]=g,t[1]=f,t[2]=m,t[3]=0,t[4]=c*m-d*f,t[5]=d*g-l*m,t[6]=l*f-c*g,t[7]=0,t[8]=l,t[9]=c,t[10]=d,t[11]=0,t[12]=i,t[13]=n,t[14]=a,t[15]=1}(this,t,e,r),this}determinant(){return function(t){let e=t[0],r=t[1],s=t[2],i=t[3],n=t[4],a=t[5],o=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],p=t[12],g=t[13],f=t[14],m=t[15];return(e*a-r*n)*(c*m-d*f)-(e*o-s*n)*(l*m-d*g)+(e*h-i*n)*(l*f-c*g)+(r*o-s*a)*(u*m-d*p)-(r*h-i*a)*(u*f-c*p)+(s*h-i*o)*(u*g-l*p)}(this)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}}function I(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],o=r[0],h=r[1],u=r[2],l=r[3];return t[0]=s*l+a*o+i*u-n*h,t[1]=i*l+a*h+n*o-s*u,t[2]=n*l+a*u+s*h-i*o,t[3]=a*l-s*o-i*h-n*u,t}class T extends Array{constructor(t=0,e=0,r=0,s=1){return super(t,e,r,s),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set w(t){this[3]=t,this.onChange()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}set(t,e,r,s){return t.length?this.copy(t):(function(t,e,r,s,i){t[0]=e,t[1]=r,t[2]=s,t[3]=i}(this,t,e,r,s),this.onChange(),this)}rotateX(t){return function(t,e,r){r*=.5;let s=e[0],i=e[1],n=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=s*h+a*o,t[1]=i*h+n*o,t[2]=n*h-i*o,t[3]=a*h-s*o}(this,this,t),this.onChange(),this}rotateY(t){return function(t,e,r){r*=.5;let s=e[0],i=e[1],n=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=s*h-n*o,t[1]=i*h+a*o,t[2]=n*h+s*o,t[3]=a*h-i*o}(this,this,t),this.onChange(),this}rotateZ(t){return function(t,e,r){r*=.5;let s=e[0],i=e[1],n=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=s*h+i*o,t[1]=i*h-s*o,t[2]=n*h+a*o,t[3]=a*h-n*o}(this,this,t),this.onChange(),this}inverse(t=this){return function(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=r*r+s*s+i*i+n*n,o=a?1/a:0;t[0]=-r*o,t[1]=-s*o,t[2]=-i*o,t[3]=n*o}(this,t),this.onChange(),this}conjugate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=r[3],this.onChange(),this}copy(t){return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],this.onChange(),this;var e,r}normalize(t=this){return function(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=r*r+s*s+i*i+n*n;a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=s*a,t[2]=i*a,t[3]=n*a}(this,t),this.onChange(),this}multiply(t,e){return e?I(this,t,e):I(this,this,t),this.onChange(),this}dot(t){return r=t,(e=this)[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3];var e,r}fromMatrix3(t){return function(t,e){let r,s=e[0]+e[4]+e[8];if(s>0)r=Math.sqrt(s+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);let i=(s+1)%3,n=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*i+i]-e[3*n+n]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*i+n]-e[3*n+i])*r,t[i]=(e[3*i+s]+e[3*s+i])*r,t[n]=(e[3*n+s]+e[3*s+n])*r}}(this,t),this.onChange(),this}fromEuler(t){return function(t,e,r="YXZ"){let s=Math.sin(.5*e[0]),i=Math.cos(.5*e[0]),n=Math.sin(.5*e[1]),a=Math.cos(.5*e[1]),o=Math.sin(.5*e[2]),h=Math.cos(.5*e[2]);"XYZ"===r?(t[0]=s*a*h+i*n*o,t[1]=i*n*h-s*a*o,t[2]=i*a*o+s*n*h,t[3]=i*a*h-s*n*o):"YXZ"===r?(t[0]=s*a*h+i*n*o,t[1]=i*n*h-s*a*o,t[2]=i*a*o-s*n*h,t[3]=i*a*h+s*n*o):"ZXY"===r?(t[0]=s*a*h-i*n*o,t[1]=i*n*h+s*a*o,t[2]=i*a*o+s*n*h,t[3]=i*a*h-s*n*o):"ZYX"===r?(t[0]=s*a*h-i*n*o,t[1]=i*n*h+s*a*o,t[2]=i*a*o-s*n*h,t[3]=i*a*h+s*n*o):"YZX"===r?(t[0]=s*a*h+i*n*o,t[1]=i*n*h+s*a*o,t[2]=i*a*o-s*n*h,t[3]=i*a*h-s*n*o):"XZY"===r&&(t[0]=s*a*h-i*n*o,t[1]=i*n*h-s*a*o,t[2]=i*a*o+s*n*h,t[3]=i*a*h+s*n*o)}(this,t,t.order),this}fromAxisAngle(t,e){return function(t,e,r){r*=.5;let s=Math.sin(r);t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(r)}(this,t,e),this}slerp(t,e){return function(t,e,r,s){let i,n,a,o,h,u=e[0],l=e[1],c=e[2],d=e[3],p=r[0],g=r[1],f=r[2],m=r[3];n=u*p+l*g+c*f+d*m,n<0&&(n=-n,p=-p,g=-g,f=-f,m=-m),1-n>1e-6?(i=Math.acos(n),a=Math.sin(i),o=Math.sin((1-s)*i)/a,h=Math.sin(s*i)/a):(o=1-s,h=s),t[0]=o*u+h*p,t[1]=o*l+h*g,t[2]=o*c+h*f,t[3]=o*d+h*m}(this,this,t,e),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}const P=new O;class B extends Array{constructor(t=0,e=t,r=t,s="YXZ"){return super(t,e,r),this.order=s,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set(t,e=t,r=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=r,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return function(t,e,r="YXZ"){"XYZ"===r?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===r?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===r?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===r?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===r?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===r&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this}fromQuaternion(t,e=this.order){return P.fromQuaternion(t),this.fromRotationMatrix(P,e)}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}}class k{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new O,this.worldMatrix=new O,this.matrixAutoUpdate=!0,this.up=new p(0,1,0),this.position=new p,this.scale=new p(1),this.quaternion=new T,this.rotation=new B,this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,r=this.children.length;e<r;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,r=this.children.length;e<r;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const U=new O,N=new p,q=new p;class D extends k{constructor(t,{near:e=.1,far:r=100,fov:s=45,aspect:i=1,left:n,right:a,bottom:o,top:h,zoom:u=1}={}){super(),Object.assign(this,{near:e,far:r,fov:s,aspect:i,left:n,right:a,bottom:o,top:h,zoom:u}),this.projectionMatrix=new O,this.viewMatrix=new O,this.projectionViewMatrix=new O,this.worldPosition=new p,this.type=n||a?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:r=this.fov,aspect:s=this.aspect}={}){return Object.assign(this,{near:t,far:e,fov:r,aspect:s}),this.projectionMatrix.fromPerspective({fov:r*(Math.PI/180),aspect:s,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:r=this.left,right:s=this.right,bottom:i=this.bottom,top:n=this.top,zoom:a=this.zoom}={}){return Object.assign(this,{near:t,far:e,left:r,right:s,bottom:i,top:n,zoom:a}),r/=a,s/=a,i/=a,n/=a,this.projectionMatrix.fromOrthogonal({left:r,right:s,bottom:i,top:n,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(U.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new p,new p,new p,new p,new p,new p]);const t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let t=0;t<6;t++){const e=1/this.frustum[t].distance();this.frustum[t].multiply(e),this.frustum[t].constant*=e}}frustumIntersectsMesh(t){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;const e=N;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);const r=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,r)}frustumIntersectsSphere(t,e){const r=q;for(let s=0;s<6;s++){const i=this.frustum[s];if(r.copy(i).dot(t)+i.constant<-e)return!1}return!0}}function j(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=r[0],p=r[1],g=r[2],f=r[3],m=r[4],v=r[5],w=r[6],y=r[7],b=r[8];return t[0]=d*s+p*a+g*u,t[1]=d*i+p*o+g*l,t[2]=d*n+p*h+g*c,t[3]=f*s+m*a+v*u,t[4]=f*i+m*o+v*l,t[5]=f*n+m*h+v*c,t[6]=w*s+y*a+b*u,t[7]=w*i+y*o+b*l,t[8]=w*n+y*h+b*c,t}class V extends Array{constructor(t=1,e=0,r=0,s=0,i=1,n=0,a=0,o=0,h=1){return super(t,e,r,s,i,n,a,o,h),this}set(t,e,r,s,i,n,a,o,h){return t.length?this.copy(t):(function(t,e,r,s,i,n,a,o,h,u){t[0]=e,t[1]=r,t[2]=s,t[3]=i,t[4]=n,t[5]=a,t[6]=o,t[7]=h,t[8]=u}(this,t,e,r,s,i,n,a,o,h),this)}translate(t,e=this){return function(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=r[0],p=r[1];t[0]=s,t[1]=i,t[2]=n,t[3]=a,t[4]=o,t[5]=h,t[6]=d*s+p*a+u,t[7]=d*i+p*o+l,t[8]=d*n+p*h+c}(this,e,t),this}rotate(t,e=this){return function(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=Math.sin(r),p=Math.cos(r);t[0]=p*s+d*a,t[1]=p*i+d*o,t[2]=p*n+d*h,t[3]=p*a-d*s,t[4]=p*o-d*i,t[5]=p*h-d*n,t[6]=u,t[7]=l,t[8]=c}(this,e,t),this}scale(t,e=this){return function(t,e,r){let s=r[0],i=r[1];t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,e,t),this}multiply(t,e){return e?j(this,t,e):j(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}fromMatrix4(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[4],e[4]=r[5],e[5]=r[6],e[6]=r[8],e[7]=r[9],e[8]=r[10],this}fromQuaternion(t){return function(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=r+r,o=s+s,h=i+i,u=r*a,l=s*a,c=s*o,d=i*a,p=i*o,g=i*h,f=n*a,m=n*o,v=n*h;t[0]=1-c-g,t[3]=l-v,t[6]=d+m,t[1]=l+v,t[4]=1-u-g,t[7]=p-f,t[2]=d-m,t[5]=p+f,t[8]=1-u-c}(this,t),this}fromBasis(t,e,r){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],r[0],r[1],r[2]),this}inverse(t=this){return function(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=l*a-o*u,d=-l*n+o*h,p=u*n-a*h,g=r*c+s*d+i*p;g&&(g=1/g,t[0]=c*g,t[1]=(-l*s+i*u)*g,t[2]=(o*s-i*a)*g,t[3]=d*g,t[4]=(l*r-i*h)*g,t[5]=(-o*r+i*n)*g,t[6]=p*g,t[7]=(-u*r+s*h)*g,t[8]=(a*r-s*n)*g)}(this,t),this}getNormalMatrix(t){return function(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],p=e[11],g=e[12],f=e[13],m=e[14],v=e[15],w=r*o-s*a,y=r*h-i*a,b=r*u-n*a,x=s*h-i*o,M=s*u-n*o,A=i*u-n*h,_=l*f-c*g,E=l*m-d*g,z=l*v-p*g,F=c*m-d*f,C=c*v-p*f,S=d*v-p*m,R=w*S-y*C+b*F+x*z-M*E+A*_;R&&(R=1/R,t[0]=(o*S-h*C+u*F)*R,t[1]=(h*z-a*S-u*E)*R,t[2]=(a*C-o*z+u*_)*R,t[3]=(i*C-s*S-n*F)*R,t[4]=(r*S-i*z+n*E)*R,t[5]=(s*z-r*C-n*_)*R,t[6]=(f*A-m*M+v*x)*R,t[7]=(m*b-g*A-v*y)*R,t[8]=(g*M-f*b+v*w)*R)}(this,t),this}}let X=0;class G extends k{constructor(t,{geometry:e,program:r,mode:s=t.TRIANGLES,frustumCulled:i=!0,renderOrder:n=0}={}){super(),this.hit=null,t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=X++,this.geometry=e,this.program=r,this.mode=s,this.frustumCulled=i,this.renderOrder=n,this.modelViewMatrix=new O,this.normalMatrix=new V,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){this.beforeRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t}))),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t})))}}new Uint8Array(4);const Y={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function Z(t){4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e||console.warn(`Unable to convert hex string ${t} to rgb values`),[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}function W(t){return[((t=parseInt(t))>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function $(t=null){return t?3===arguments.length?arguments:isNaN(t)?"#"===t[0]?Z(t):Y[t.toLowerCase()]?Z(Y[t.toLowerCase()]):(console.warn("Color format not recognised"),[0,0,0]):W(t):[0,0,0]}class H extends Array{constructor(t=null){Array.isArray(t)?super(...t):super(...$(...arguments))}get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}set r(t){this[0]=t}set g(t){this[1]=t}set b(t){this[2]=t}set(t){return Array.isArray(t)?this.copy(t):this.copy($(...arguments))}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this}}function Q(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function K(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function J(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function tt(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function et(t,e){return t[0]*e[1]-t[1]*e[0]}class rt extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}set(t,e=t){return t.length?this.copy(t):(function(t,e,r){t[0]=e,t[1]=r}(this,t,e),this)}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],this}add(t,e){return e?Q(this,t,e):Q(this,this,t),this}sub(t,e){return e?K(this,t,e):K(this,this,t),this}multiply(t){var e,r;return t.length?(this,r=t,(e=this)[0]=this[0]*r[0],e[1]=this[1]*r[1]):J(this,this,t),this}divide(t){var e,r;return t.length?(this,r=t,(e=this)[0]=this[0]/r[0],e[1]=this[1]/r[1]):J(this,this,1/t),this}inverse(t=this){var e,r;return r=t,(e=this)[0]=1/r[0],e[1]=1/r[1],this}len(){return tt(this)}distance(t){return t?(this,r=(e=t)[0]-this[0],s=e[1]-this[1],Math.sqrt(r*r+s*s)):tt(this);var e,r,s}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?(this,(r=(e=t)[0]-this[0])*r+(s=e[1]-this[1])*s):function(t){var e=t[0],r=t[1];return e*e+r*r}(this);var e,r,s}negate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],this}cross(t,e){return e?et(t,e):et(this,t)}scale(t){return J(this,this,t),this}normalize(){var t,e,r,s;return this,(s=(e=(t=this)[0])*e+(r=t[1])*r)>0&&(s=1/Math.sqrt(s)),this[0]=t[0]*s,this[1]=t[1]*s,this}dot(t){return e=t,this[0]*e[0]+this[1]*e[1];var e}equals(t){return e=t,this[0]===e[0]&&this[1]===e[1];var e}applyMatrix3(t){var e,r,s;return this,e=t,r=this[0],s=this[1],this[0]=e[0]*r+e[3]*s+e[6],this[1]=e[1]*r+e[4]*s+e[7],this}applyMatrix4(t){return function(t,e,r){let s=e[0],i=e[1];t[0]=r[0]*s+r[4]*i+r[12],t[1]=r[1]*s+r[5]*i+r[13]}(this,this,t),this}lerp(t,e){!function(t,e,r,s){var i=e[0],n=e[1];t[0]=i+s*(r[0]-i),t[1]=n+s*(r[1]-n)}(this,this,t,e)}clone(){return new rt(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}}const st=-1,it=new p,nt=new rt,at=new rt;function ot(t,{element:e=document.body,enabled:r=!0,target:s=new p,ease:i=.25,inertia:n=.85,enableRotate:a=!0,rotateSpeed:o=.1,autoRotate:h=!1,autoRotateSpeed:u=1,enableZoom:l=!0,zoomSpeed:c=1,enablePan:d=!0,panSpeed:g=.1,minPolarAngle:f=0,maxPolarAngle:m=Math.PI,minAzimuthAngle:v=-1/0,maxAzimuthAngle:w=1/0,minDistance:y=0,maxDistance:b=1/0}={}){this.enabled=r,this.target=s,i=i||1,n=n||0,this.minDistance=y,this.maxDistance=b;const x={radius:1,phi:0,theta:0},M={radius:1,phi:0,theta:0},A={radius:1,phi:0,theta:0},_=new p,E=new p;E.copy(t.position).sub(this.target),A.radius=M.radius=E.distance(),A.theta=M.theta=Math.atan2(E.x,E.z),A.phi=M.phi=Math.acos(Math.min(Math.max(E.y/M.radius,-1),1)),this.offset=E,this.update=()=>{h&&function(){const t=2*Math.PI/60/60*u;x.theta-=t}(),M.radius*=x.radius,M.theta+=x.theta,M.phi+=x.phi,M.theta=Math.max(v,Math.min(w,M.theta)),M.phi=Math.max(f,Math.min(m,M.phi)),M.radius=Math.max(this.minDistance,Math.min(this.maxDistance,M.radius)),A.phi+=(M.phi-A.phi)*i,A.theta+=(M.theta-A.theta)*i,A.radius+=(M.radius-A.radius)*i,this.target.add(_);let e=A.radius*Math.sin(Math.max(1e-6,A.phi));E.x=e*Math.sin(A.theta),E.y=A.radius*Math.cos(A.phi),E.z=e*Math.cos(A.theta),t.position.copy(this.target).add(E),t.lookAt(this.target),x.theta*=n,x.phi*=n,_.multiply(n),x.radius=1},this.forcePosition=()=>{E.copy(t.position).sub(this.target),A.radius=M.radius=E.distance(),A.theta=M.theta=Math.atan2(E.x,E.z),A.phi=M.phi=Math.acos(Math.min(Math.max(E.y/M.radius,-1),1)),t.lookAt(this.target)};const z=new rt,F=new rt,C=new rt;let S=st;function R(){return Math.pow(.95,c)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};const L=(r,s)=>{it.copy(t.position).sub(this.target);let i=it.distance();var n,a;i*=Math.tan((t.fov||45)/2*Math.PI/180),n=2*r*i/e.clientHeight,a=t.matrix,it.set(a[0],a[1],a[2]),it.multiply(-n),_.add(it),function(t,e){it.set(e[4],e[5],e[6]),it.multiply(t),_.add(it)}(2*s*i/e.clientHeight,t.matrix)};function O(t){x.radius/=t}function I(t,r){nt.set(t,r),at.sub(nt,z).multiply(o),x.theta-=2*Math.PI*at.x/e.clientHeight,x.phi-=2*Math.PI*at.y/e.clientHeight,z.copy(nt)}function T(t,e){nt.set(t,e),at.sub(nt,F).multiply(g),L(at.x,at.y),F.copy(nt)}const P=t=>{if(this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===a)return;z.set(t.clientX,t.clientY),S=0;break;case this.mouseButtons.ZOOM:if(!1===l)return;C.set(t.clientX,t.clientY),S=1;break;case this.mouseButtons.PAN:if(!1===d)return;F.set(t.clientX,t.clientY),S=2}S!==st&&(window.addEventListener("mousemove",B,!1),window.addEventListener("mouseup",k,!1))}},B=t=>{if(this.enabled)switch(S){case 0:if(!1===a)return;I(t.clientX,t.clientY);break;case 1:if(!1===l)return;!function(t){nt.set(t.clientX,t.clientY),at.sub(nt,C),at.y>0?O(R()):at.y<0&&O(1/R()),C.copy(nt)}(t);break;case 2:if(!1===d)return;T(t.clientX,t.clientY)}},k=()=>{window.removeEventListener("mousemove",B,!1),window.removeEventListener("mouseup",k,!1),S=st},U=t=>{this.enabled&&l&&(S===st||0===S)&&(t.stopPropagation(),t.preventDefault(),t.deltaY<0?O(1/(1.2*R())):t.deltaY>0&&O(1.2*R()))},N=t=>{if(this.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===a)return;z.set(t.touches[0].pageX,t.touches[0].pageY),S=0;break;case 2:if(!1===l&&!1===d)return;!function(t){if(l){let e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(e*e+r*r);C.set(0,s)}if(d){let e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);F.set(e,r)}}(t),S=3;break;default:S=st}},q=t=>{if(this.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===a)return;I(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===l&&!1===d)return;!function(t){if(l){let e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(e*e+r*r);nt.set(0,s),at.set(0,Math.pow(nt.y/C.y,c)),O(at.y),C.copy(nt)}d&&T(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}(t);break;default:S=st}},D=()=>{this.enabled&&(S=st)},j=t=>{this.enabled&&t.preventDefault()};this.remove=function(){e.removeEventListener("contextmenu",j),e.removeEventListener("mousedown",P),e.removeEventListener("wheel",U),e.removeEventListener("touchstart",N),e.removeEventListener("touchend",D),e.removeEventListener("touchmove",q),window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",k)},e.addEventListener("contextmenu",j,!1),e.addEventListener("mousedown",P,!1),e.addEventListener("wheel",U,{passive:!1}),e.addEventListener("touchstart",N,{passive:!1}),e.addEventListener("touchend",D,!1),e.addEventListener("touchmove",q,{passive:!1})}new rt,new rt,new rt,new p,new p,new p,new p,new p,new p,new p,new p,new p,new p,new p,new O;const ht="cubicbezier",ut="quadraticbezier",lt=new p,ct=new p,dt=new p,pt=new p;function gt(t,e,r,s){const i=1-t;lt.copy(e).scale(Math.pow(i,2)),ct.copy(r).scale(2*i*t),dt.copy(s).scale(Math.pow(t,2));const n=new p;return n.add(lt,ct).add(dt),n}function ft(t,e,r,s,i){const n=1-t;lt.copy(e).scale(Math.pow(n,3)),ct.copy(r).scale(3*Math.pow(n,2)*t),dt.copy(s).scale(3*n*Math.pow(t,2)),pt.copy(i).scale(Math.pow(t,3));const a=new p;return a.add(lt,ct).add(dt).add(pt),a}class mt{constructor({points:t=[new p(0,0,0),new p(0,1,0),new p(1,1,0),new p(1,0,0)],divisions:e=12,type:r=mt.CATMULLROM}={}){this.points=t,this.divisions=e,this.type=r}_getQuadraticBezierPoints(t=this.divisions){const e=[],r=this.points.length;if(r<3)return console.warn("Not enough points provided."),[];const s=this.points[0];let i=this.points[1],n=this.points[2];for(let r=0;r<=t;r++){const a=gt(r/t,s,i,n);e.push(a)}let a=3;for(;r-a>0;){s.copy(n),i=n.scale(2).sub(i),n=this.points[a];for(let r=1;r<=t;r++){const a=gt(r/t,s,i,n);e.push(a)}a++}return e}_getCubicBezierPoints(t=this.divisions){const e=[],r=this.points.length;if(r<4)return console.warn("Not enough points provided."),[];let s=this.points[0],i=this.points[1],n=this.points[2],a=this.points[3];for(let r=0;r<=t;r++){const o=ft(r/t,s,i,n,a);e.push(o)}let o=4;for(;r-o>1;){s.copy(a),i=a.scale(2).sub(n),n=this.points[o],a=this.points[o+1];for(let r=1;r<=t;r++){const o=ft(r/t,s,i,n,a);e.push(o)}o+=2}return e}_getCatmullRomPoints(t=this.divisions,e=.168,r=.168){const s=[];if(this.points.length<=2)return this.points;let i;return this.points.forEach(((n,a)=>{if(0===a)i=n;else{const[o,h]=function(t,e,r=.168,s=.168){if(e<1?lt.sub(t[1],t[0]).scale(r).add(t[0]):lt.sub(t[e+1],t[e-1]).scale(r).add(t[e]),e>t.length-3){const e=t.length-1;ct.sub(t[e-1],t[e]).scale(s).add(t[e])}else ct.sub(t[e],t[e+2]).scale(s).add(t[e+1]);return[lt.clone(),ct.clone()]}(this.points,a-1,e,r),u=new mt({points:[i,o,h,n],type:mt.CUBICBEZIER});s.pop(),s.push(...u.getPoints(t)),i=n}})),s}getPoints(t=this.divisions,e=.168,r=.168){const s=this.type;return s===ut?this._getQuadraticBezierPoints(t):s===ht?this._getCubicBezierPoints(t):s===mt.CATMULLROM?this._getCatmullRomPoints(t,e,r):this.points}}mt.CATMULLROM="catmullrom",mt.CUBICBEZIER="cubicbezier",mt.QUADRATICBEZIER="quadraticbezier",mt.CATMULLROM="catmullrom",mt.CUBICBEZIER=ht,mt.QUADRATICBEZIER=ut,new p,new T,new p,new p,new T,new p,new O;const vt=new p;class wt{constructor(t,{points:e,vertex:r=yt,fragment:s=bt,uniforms:i={},attributes:n={}}){this.gl=t,this.points=e,this.count=e.length,this.position=new Float32Array(3*this.count*2),this.prev=new Float32Array(3*this.count*2),this.next=new Float32Array(3*this.count*2);const a=new Float32Array(1*this.count*2),o=new Float32Array(2*this.count*2),h=new Uint16Array(3*(this.count-1)*2);for(let t=0;t<this.count;t++){a.set([-1,1],2*t);const e=t/(this.count-1);if(o.set([0,e,1,e],4*t),t===this.count-1)continue;const r=2*t;h.set([r+0,r+1,r+2],3*(r+0)),h.set([r+2,r+1,r+3],3*(r+1))}const u=this.geometry=new w(t,Object.assign(n,{position:{size:3,data:this.position},prev:{size:3,data:this.prev},next:{size:3,data:this.next},side:{size:1,data:a},uv:{size:2,data:o},index:{size:1,data:h}}));this.updateGeometry(),i.uResolution||(this.resolution=i.uResolution={value:new rt}),i.uDPR||(this.dpr=i.uDPR={value:1}),i.uThickness||(this.thickness=i.uThickness={value:1}),i.uColor||(this.color=i.uColor={value:new H("#000")}),i.uMiter||(this.miter=i.uMiter={value:1}),this.resize();const l=this.program=new x(t,{vertex:r,fragment:s,uniforms:i});this.mesh=new G(t,{geometry:u,program:l})}updateGeometry(){this.points.forEach(((t,e)=>{t.toArray(this.position,3*e*2),t.toArray(this.position,3*e*2+3),e?(t.toArray(this.next,3*(e-1)*2),t.toArray(this.next,3*(e-1)*2+3)):(vt.copy(t).sub(this.points[e+1]).add(t),vt.toArray(this.prev,3*e*2),vt.toArray(this.prev,3*e*2+3)),e===this.points.length-1?(vt.copy(t).sub(this.points[e-1]).add(t),vt.toArray(this.next,3*e*2),vt.toArray(this.next,3*e*2+3)):(t.toArray(this.prev,3*(e+1)*2),t.toArray(this.prev,3*(e+1)*2+3))})),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.prev.needsUpdate=!0,this.geometry.attributes.next.needsUpdate=!0}resize(){this.resolution&&this.resolution.value.set(this.gl.canvas.width,this.gl.canvas.height),this.dpr&&(this.dpr.value=this.gl.renderer.dpr)}}const yt="\n    precision highp float;\n\n    attribute vec3 position;\n    attribute vec3 next;\n    attribute vec3 prev;\n    attribute vec2 uv;\n    attribute float side;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform vec2 uResolution;\n    uniform float uDPR;\n    uniform float uThickness;\n    uniform float uMiter;\n\n    varying vec2 vUv;\n\n    vec4 getPosition() {\n        mat4 mvp = projectionMatrix * modelViewMatrix;\n        vec4 current = mvp * vec4(position, 1);\n        vec4 nextPos = mvp * vec4(next, 1);\n        vec4 prevPos = mvp * vec4(prev, 1);\n\n        vec2 aspect = vec2(uResolution.x / uResolution.y, 1);    \n        vec2 currentScreen = current.xy / current.w * aspect;\n        vec2 nextScreen = nextPos.xy / nextPos.w * aspect;\n        vec2 prevScreen = prevPos.xy / prevPos.w * aspect;\n    \n        vec2 dir1 = normalize(currentScreen - prevScreen);\n        vec2 dir2 = normalize(nextScreen - currentScreen);\n        vec2 dir = normalize(dir1 + dir2);\n    \n        vec2 normal = vec2(-dir.y, dir.x);\n        normal /= mix(1.0, max(0.3, dot(normal, vec2(-dir1.y, dir1.x))), uMiter);\n        normal /= aspect;\n\n        float pixelWidthRatio = 1.0 / (uResolution.y / uDPR);\n        float pixelWidth = current.w * pixelWidthRatio;\n        normal *= pixelWidth * uThickness;\n        current.xy -= normal * side;\n    \n        return current;\n    }\n\n    void main() {\n        vUv = uv;\n        gl_Position = getPosition();\n    }\n",bt="\n    precision highp float;\n\n    uniform vec3 uColor;\n    \n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor.rgb = uColor;\n        gl_FragColor.a = 1.0;\n    }\n";new p,new p,new p,new p,new T,new T,new T,new T,new O,new O,Uint8Array,Int16Array,Uint16Array,Uint32Array,Float32Array,Uint8Array,Uint8Array},607:(t,e,r)=>{"use strict";r.a(t,(async(t,e)=>{try{var s=r(368),i=r(428),n=r(708),a=r(330),o=r(750),h=r.n(o),u=t([a]);a=(u.then?(await u)():u)[0];const c=document.getElementById("canvas"),d=new s.Th({canvas:c,width:600,height:400,antialias:!1,dpr:1}),p=d.gl;document.body.appendChild(p.canvas),p.clearColor(.2,.2,.2,1),document.getElementById("central_div").appendChild(c);const g=document.getElementById("settings_div");g.style.display="none",document.getElementById("bake_button").addEventListener("click",B,!1);const f=document.getElementById("export_button");f.addEventListener("click",U,!1);const m=new s.$r(p,{vertex:n.hh,fragment:n.Vx,transparent:!1,depthTest:!0}),v=new s.$r(p,{vertex:n.mf,fragment:n.mq,transparent:!0,cullFace:null,depthTest:!1}),w=new s.V1(p,{fov:35,far:400,near:.1});w.position.set(3,3,3);const y=new s.qZ(w,{target:new s.AO(0,0,0),zoomSpeed:.5});function b(){const t=window.innerWidth-20,e=window.innerHeight-20;d.setSize(t,e),w.perspective({aspect:p.canvas.width/p.canvas.height})}g.addEventListener("mouseleave",(function(t){y.enabled=!0}),!1),g.addEventListener("mouseover",(function(t){y.enabled=!1}),!1),window.addEventListener("resize",b,!1),b();const x=document.getElementById("file_input");var l="";x.addEventListener("change",(t=>{const e=t.target.files[0];l=e.name.split(".")[0];let r=new FileReader;r.addEventListener("load",(function(t){let e=t.target.result;const r=M.children.length;for(let t=0;t<r;t++)M.removeChild(M.children[r-t-1]);A=(0,i.pe)(e,p),_=new s.Kj(p,{geometry:A.get_geometry(),program:m}),_.setParent(M),g.style.display="block",f.style.display="none"})),r.readAsText(e)}));const M=new s.wx;let A=null,_=null,E=null,z=new Array(0),F=new Float32Array(0),C=new Int32Array(0),S=new Int32Array(0),R={x:0,y:0,z:0};function L(t){requestAnimationFrame(L),y.update(),d.render({scene:M,camera:w})}function O(t){let e="";for(let r=0;r<t.length;r++)e+=t[r]+(r==t.length-1?"":", ");return e}function I(t,e){const r=document.getElementById(t);return e?parseInt(r.value):parseFloat(r.value)}function T(t,e){const r=t.length/3;for(let e=0;e<r;e++)R.x+=t[3*e],R.y+=t[3*e+1],R.z+=t[3*e+2];R.x/=r,R.y/=r,R.z/=r;let s=new Float32Array(3*r);for(let i=0;i<r;i++){const r=t[3*i],n=t[3*i+1],a=t[3*i+2];s[3*i]=(r-R.x)*e+R.x,s[3*i+1]=(n-R.y)*e+R.y,s[3*i+2]=(a-R.z)*e+R.z}return s}function P(t,e){const r=t.length/3;let s=new Float32Array(3*r);for(let i=0;i<r;i++){const r=t[3*i],n=t[3*i+1],a=t[3*i+2];s[3*i]=(r-R.x)/e+R.x,s[3*i+1]=(n-R.y)/e+R.y,s[3*i+2]=(a-R.z)/e+R.z}return s}function B(){if(null!=A){null!=E&&M.removeChild(E);for(let t=0;t<z.length;t++)M.removeChild(z[t]);z=new Array(0),F=new Float32Array(0),C=new Int32Array(0),S=new Int32Array(0);const t=I("settings_scale",!1),e=(0,a.un)();(0,a.bb)(e,T(A.get_vertices(),t),A.get_polygons(),A.get_sizes()),(0,a.MQ)(e,I("settings_cell_size",!1),I("settings_cell_height",!1),I("settings_agent_height",!1)*t,I("settings_agent_radius",!1)*t,I("settings_agent_max_climb",!1),I("settings_agent_max_slope",!1),I("settings_region_min_size",!0)*t,I("settings_region_merge_size",!0)*t,I("settings_edge_max_len",!1)*t,I("settings_edge_max_error",!1),I("settings_verts_per_poly",!0),I("settings_detail_sample_distance",!1),I("settings_detail_sample_maximum_error",!1)),F=P((0,a.V0)(e),t),C=(0,a.SL)(e),S=(0,a.N5)(e);const r=(0,i.nx)(p,F,C,S);E=new s.Kj(p,{geometry:r,program:v}),E.setParent(M),(0,i.mH)(p,z,F,C,S);for(let t=0;t<z.length;t++)z[t].setParent(M);f.style.display="block"}}function k(){}function U(){if(F.length>0&&C.length>0&&S.length>0){const e=[O(F),O(C),O(S)].join("\n");var t=new Blob([e],{type:"text/plain;charset=utf-8"});h().saveAs(t,l+"_navmesh.txt")}}requestAnimationFrame(L),window.on_change_settings=k,e()}catch(N){e(N)}}))},428:(t,e,r)=>{"use strict";r.d(e,{pe:()=>o,nx:()=>h,mH:()=>u});var s=r(368);class i{constructor(t,e){this.defaultModelName="untitled",this.currentMaterial="",this.currentGroup="",this.smoothingGroup=0,this.result={materialLibraries:[],models:[]},this.fileContents=t,void 0!==e&&(this.defaultModelName=e)}parseAsync(){return new Promise(((t,e)=>{try{t(this.parse())}catch(t){e(t)}}))}parse(){const t=t=>{const e=t.indexOf("#");return e>-1?t.substring(0,e):t},e=this.fileContents.split("\n");for(const r of e){const e=t(r).replace(/\s\s+/g," ").trim().split(" ");switch(e[0].toLowerCase()){case"o":this.parseObject(e);break;case"g":this.parseGroup(e);break;case"v":this.parseVertexCoords(e);break;case"vt":this.parseTextureCoords(e);break;case"vn":this.parseVertexNormal(e);break;case"s":this.parseSmoothShadingStatement(e);break;case"f":this.parsePolygon(e);break;case"mtllib":this.parseMtlLib(e);break;case"usemtl":this.parseUseMtl(e)}}return this.result}currentModel(){return 0===this.result.models.length&&(this.result.models.push({faces:[],name:this.defaultModelName,textureCoords:[],vertexNormals:[],vertices:[]}),this.currentGroup="",this.smoothingGroup=0),this.result.models[this.result.models.length-1]}parseObject(t){const e=t.length>=2?t[1]:this.defaultModelName;this.result.models.push({faces:[],name:e,textureCoords:[],vertexNormals:[],vertices:[]}),this.currentGroup="",this.smoothingGroup=0}parseGroup(t){if(2!==t.length)throw"Group statements must have exactly 1 argument (eg. g group_1)";this.currentGroup=t[1]}parseVertexCoords(t){const e=t.length>=2?parseFloat(t[1]):0,r=t.length>=3?parseFloat(t[2]):0,s=t.length>=4?parseFloat(t[3]):0;this.currentModel().vertices.push({x:e,y:r,z:s})}parseTextureCoords(t){const e=t.length>=2?parseFloat(t[1]):0,r=t.length>=3?parseFloat(t[2]):0,s=t.length>=4?parseFloat(t[3]):0;this.currentModel().textureCoords.push({u:e,v:r,w:s})}parseVertexNormal(t){const e=t.length>=2?parseFloat(t[1]):0,r=t.length>=3?parseFloat(t[2]):0,s=t.length>=4?parseFloat(t[3]):0;this.currentModel().vertexNormals.push({x:e,y:r,z:s})}parsePolygon(t){const e=t.length-1;if(e<3)throw"Face statement has less than 3 vertices";const r={group:this.currentGroup,material:this.currentMaterial,smoothingGroup:this.smoothingGroup,vertices:[]};for(let s=0;s<e;s+=1){const e=t[s+1].split("/");if(e.length<1||e.length>3)throw"Two many values (separated by /) for a single vertex";let i=0,n=0,a=0;if(i=parseInt(e[0],10),e.length>1&&""!==e[1]&&(n=parseInt(e[1],10)),e.length>2&&(a=parseInt(e[2],10)),0===i)throw"Faces uses invalid vertex index of 0";i<0&&(i=this.currentModel().vertices.length+1+i),r.vertices.push({textureCoordsIndex:n,vertexIndex:i,vertexNormalIndex:a})}this.currentModel().faces.push(r)}parseMtlLib(t){t.length>=2&&this.result.materialLibraries.push(t[1])}parseUseMtl(t){t.length>=2&&(this.currentMaterial=t[1])}parseSmoothShadingStatement(t){if(2!==t.length)throw"Smoothing group statements must have exactly 1 argument (eg. s <number|off>)";const e="off"===t[1].toLowerCase()?0:parseInt(t[1],10);this.smoothingGroup=e}}function n(t,e,r){const i=new s.AO;i.sub(e,t);const n=new s.AO;n.sub(r,t);const a=new s.AO;return a.cross(i,n),a.normalize(),a}class a{constructor(t,e){if(null==t)this.m_geometry=new s.ZX(e),this.m_vertices=new Float32Array(0),this.m_polygons=new Int32Array(0),this.m_sizes=new Int32Array(0);else{const r=t.vertices,i=t.faces,a=t.vertexNormals,o=a.length>0,h=new Array(0),u=new Array(0),l=new Array(0);this.m_vertices=new Float32Array(3*r.length);for(let t=0;t<r.length;t++){const e=r[t];this.m_vertices[3*t]=e.x,this.m_vertices[3*t+1]=e.y,this.m_vertices[3*t+2]=e.z}this.m_sizes=new Int32Array(i.length);let c=0;for(let t=0;t<i.length;t++)c+=i[t].vertices.length;this.m_polygons=new Int32Array(c);let d=0,p=0;for(let t=0;t<i.length;t++){const e=i[t],s=e.vertices.length;this.m_sizes[t]=s;for(let t=0;t<s;t++){const s=e.vertices[t];this.m_polygons[p]=s.vertexIndex-1,p++;const i=r[s.vertexIndex-1];if(h.push(i.x),h.push(i.y),h.push(i.z),o){const t=a[s.vertexNormalIndex-1];u.push(t.x),u.push(t.y),u.push(t.z)}}for(let t=0;t<s-2;t++)l.push(d),l.push(d+t+1),l.push(d+t+2);d+=s}if(!o)for(let t=0;t<h.length/9;t++){const e=new s.AO(h[9*t],h[9*t+1],h[9*t+2]),r=new s.AO(h[9*t+3],h[9*t+4],h[9*t+5]),i=new s.AO(h[9*t+6],h[9*t+7],h[9*t+8]),a=n(e,r,i),o=n(r,i,e),l=n(i,e,r);u.push(a.x),u.push(a.y),u.push(a.z),u.push(o.x),u.push(o.y),u.push(o.z),u.push(l.x),u.push(l.y),u.push(l.z)}this.m_geometry=new s.ZX(e,{position:{size:3,data:new Float32Array(h)},normal:{size:3,data:new Float32Array(u)},index:{data:new Uint32Array(l)}})}}get_geometry(){return this.m_geometry}get_vertices(){return this.m_vertices}get_polygons(){return this.m_polygons}get_sizes(){return this.m_sizes}}function o(t,e){const r=new i(t).parse().models;if(r.length>0){const t=r[0];return new a(t,e)}return new a(null,e)}function h(t,e,r,i){const n=new Array(0),a=new Array(0);let o=0,h=0;for(let t=0;t<i.length;t++){const s=i[t];for(let t=0;t<s;t++){const t=r[o];o++,n.push(e[3*t]),n.push(e[3*t+1]),n.push(e[3*t+2])}for(let t=0;t<s-2;t++)a.push(h),a.push(h+t+1),a.push(h+t+2);h+=s}return new s.ZX(t,{position:{size:3,data:new Float32Array(n)},index:{data:new Uint16Array(a)}})}function u(t,e,r,i,n){let a=0;for(let o=0;o<n.length;o++){const h=n[o],u=new Array(h+1);let l=new s.AO;for(let t=0;t<h;t++){const e=i[a];a++,u[t]=new s.AO(r[3*e],r[3*e+1],r[3*e+2]),0==t&&l.set(r[3*e],r[3*e+1],r[3*e+2])}u[h]=l;const c=new s.aH(t,{points:u,uniforms:{uColor:{value:new s.Il(.3,.73,.96)},uThickness:{value:2}}});c.program.depthTest=!1;const d=new s.Kj(t,{geometry:c.geometry,program:c.program});e.push(d)}}},708:(t,e,r)=>{"use strict";r.d(e,{Vx:()=>i,hh:()=>s,mf:()=>n,mq:()=>a});const s="\nprecision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n\nvarying vec3 vNormal;\n\nvoid main() {\n    vNormal = normalize(normalMatrix * normal);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",i="\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vNormal;\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    float lighting = dot(normal, normalize(vec3(-0.3, 0.8, 0.6)));\n    //gl_FragColor.rgb = vec3(0.2, 0.8, 1.0) + lighting * 0.1;\n    gl_FragColor.rgb = vec3(0.53, 0.59, 0.6) + lighting * 0.1;\n    gl_FragColor.a = 1.0;\n}",n="\nprecision highp float;\nprecision highp int;\n\nattribute vec3 position;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",a="\nprecision highp float;\nprecision highp int;\n\nvoid main() {\n    gl_FragColor.rgb = vec3(0.3, 0.73, 0.96);\n    gl_FragColor.a = 0.4;\n}"},330:(t,e,r)=>{"use strict";r.a(t,(async(t,s)=>{try{async function i(t,e={}){const r={env:Object.assign(Object.create(globalThis),e.env||{},{abort(t,e,r,s){t=a(t>>>0),e=a(e>>>0),r>>>=0,s>>>=0,(()=>{throw Error(`${t} in ${e}:${r}:${s}`)})()}})},{exports:s}=await WebAssembly.instantiate(t,r),i=s.memory||e.env.memory,n=Object.setPrototypeOf({create_baker:()=>function(t){if(!t)return null;const e=new u(p(t));return l.register(e,t),e}(s.create_baker()>>>0),baker_add_geometry(t,e,r,n){t=p(c(t)||f()),e=p(h(((t,e)=>{new Float32Array(i.buffer)[t>>>2]=e}),10,2,e,Float32Array)||f()),r=p(h(((t,e)=>{new Int32Array(i.buffer)[t>>>2]=e}),9,2,r,Int32Array)||f()),n=h(((t,e)=>{new Int32Array(i.buffer)[t>>>2]=e}),9,2,n,Int32Array)||f();try{s.baker_add_geometry(t,e,r,n)}finally{g(t),g(e),g(r)}},baker_bake:(t,e,r,i,n,a,o,h,u,l,d,p,g,m)=>(t=c(t)||f(),0!=s.baker_bake(t,e,r,i,n,a,o,h,u,l,d,p,g,m)),baker_get_navmesh_vertices:t=>(t=c(t)||f(),o((t=>new Float64Array(i.buffer)[t>>>3]),3,s.baker_get_navmesh_vertices(t)>>>0)),baker_get_navmesh_polygons:t=>(t=c(t)||f(),o((t=>new Int32Array(i.buffer)[t>>>2]),2,s.baker_get_navmesh_polygons(t)>>>0)),baker_get_navmesh_sizes:t=>(t=c(t)||f(),o((t=>new Int32Array(i.buffer)[t>>>2]),2,s.baker_get_navmesh_sizes(t)>>>0))},s);function a(t){if(!t)return null;const e=t+new Uint32Array(i.buffer)[t-4>>>2]>>>1,r=new Uint16Array(i.buffer);let s=t>>>1,n="";for(;e-s>1024;)n+=String.fromCharCode(...r.subarray(s,s+=1024));return n+String.fromCharCode(...r.subarray(s,e))}function o(t,e,r){if(!r)return null;const s=new Uint32Array(i.buffer)[r-4>>>2]>>>e,n=new Array(s);for(let i=0;i<s;++i)n[i]=t(r+(i<<e>>>0));return n}function h(t,e,r,n,a){if(null==n)return 0;const o=n.length,h=s.__pin(s.__new(o<<r,e))>>>0;if(a)new a(i.buffer,h,o).set(n);else for(let e=0;e<o;e++)t(h+(e<<r>>>0),n[e]);return s.__unpin(h),h}class u extends Number{}const l=new FinalizationRegistry(g);function c(t){if(null==t)return 0;if(t instanceof u)return t.valueOf();throw TypeError("internref expected")}const d=new Map;function p(t){if(t){const e=d.get(t);e?d.set(t,e+1):d.set(s.__pin(t),1)}return t}function g(t){if(t){const e=d.get(t);if(1===e)s.__unpin(t),d.delete(t);else{if(!e)throw Error(`invalid refcount '${e}' for reference '${t}'`);d.set(t,e-1)}}}function f(){throw TypeError("value must not be null")}return n}r.d(e,{MQ:()=>h,N5:()=>c,SL:()=>l,V0:()=>u,bb:()=>o,un:()=>a});const{memory:n,create_baker:a,baker_add_geometry:o,baker_bake:h,baker_get_navmesh_vertices:u,baker_get_navmesh_polygons:l,baker_get_navmesh_sizes:c}=await(async t=>i(await(async()=>await globalThis.WebAssembly.compileStreaming(globalThis.fetch(t)))(),{}))(new URL(r(181),r.b));s()}catch(d){s(d)}}),1)},181:(t,e,r)=>{"use strict";t.exports=r.p+"3b43fce5890a543e.wasm"}},n={};function a(t){var e=n[t];if(void 0!==e)return e.exports;var r=n[t]={exports:{}};return i[t].call(r.exports,r,r.exports,a),r.exports}a.m=i,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&!t.d&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},a.a=(i,n,a)=>{var o;a&&((o=[]).d=1);var h,u,l,c=new Set,d=i.exports,p=new Promise(((t,e)=>{l=e,u=t}));p[e]=d,p[t]=t=>(o&&t(o),c.forEach(t),p.catch((t=>{}))),i.exports=p,n((i=>{var n;h=(i=>i.map((i=>{if(null!==i&&"object"==typeof i){if(i[t])return i;if(i.then){var n=[];n.d=0,i.then((t=>{a[e]=t,s(n)}),(t=>{a[r]=t,s(n)}));var a={};return a[t]=t=>t(n),a}}var o={};return o[t]=t=>{},o[e]=i,o})))(i);var a=()=>h.map((t=>{if(t[r])throw t[r];return t[e]})),u=new Promise((e=>{(n=()=>e(a)).r=0;var r=t=>t!==o&&!c.has(t)&&(c.add(t),t&&!t.d&&(n.r++,t.push(n)));h.map((e=>e[t](r)))}));return n.r?u:a()}),(t=>(t?l(p[r]=t):u(d),s(o)))),o&&(o.d=0)},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");r.length&&(t=r[r.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t})(),a.b=document.baseURI||self.location.href,a(607)})();