async function t(t,e={}){const s={env:Object.assign(Object.create(globalThis),e.env||{},{abort(t,e,s,i){t=n(t>>>0),e=n(e>>>0),s>>>=0,i>>>=0,(()=>{throw Error(`${t} in ${e}:${s}:${i}`)})()},"host.define_level"(t,e,s){t>>>=0,e>>>=0,host.define_level(t,e,s)},"host.define_total_tiles"(t){t>>>=0,host.define_total_tiles(t)},"host.define_navmesh"(t,e,s){t=a(p,2,t>>>0),e=a(g,2,e>>>0),s=a(g,2,s>>>0),host.define_navmesh(t,e,s)},"host.create_player"(t){host.create_player(t)},"host.define_player_changes"(t,e,s,i){i=0!=i,host.define_player_changes(t,e,s,i)},"host.define_total_update_entities"(t){t>>>=0,host.define_total_update_entities(t)},"host.define_monster_changes"(t,e,s,i,_){t>>>=0,_=0!=_,host.define_monster_changes(t,e,s,i,_)},"host.debug_entity_walk_path"(t,e){t>>>=0,e=a(p,2,e>>>0),host.debug_entity_walk_path(t,e)},"host.debug_close_entity"(t,e,s,i,_,m){t>>>=0,i>>>=0,host.debug_close_entity(t,e,s,i,_,m)},"host.tile_delete"(t){t>>>=0,host.tile_delete(t)},"host.tile_create"(t,e,s,i){t>>>=0,e>>>=0,s>>>=0,i>>>=0,host.tile_create(t,e,s,i)},"host.remove_monster"(t){t>>>=0,host.remove_monster(t)},"host.create_monster"(t,e){t>>>=0,host.create_monster(t,e)}})},{exports:i}=await WebAssembly.instantiate(t,s),_=i.memory||e.env.memory,m=Object.setPrototypeOf({create_settings:()=>o(i.create_settings()>>>0),settings_set_seed(t,e){t=c(t)||u(),i.settings_set_seed(t,e)},settings_set_generate(t,e,s,_,m){t=c(t)||u(),i.settings_set_generate(t,e,s,_,m)},settings_set_use_debug(t,e){t=c(t)||u(),e=e?1:0,i.settings_set_use_debug(t,e)},settings_set_debug_flags(t,e,s){t=c(t)||u(),e=e?1:0,s=s?1:0,i.settings_set_debug_flags(t,e,s)},settings_set_neighborhood_quad_size(t,e){t=c(t)||u(),i.settings_set_neighborhood_quad_size(t,e)},settings_set_rvo_time_horizon(t,e){t=c(t)||u(),i.settings_set_rvo_time_horizon(t,e)},create_game:t=>(t=c(t)||u(),o(i.create_game(t)>>>0)),game_update(t,e){t=c(t)||u(),i.game_update(t,e)},game_client_point:(t,e,s)=>(t=c(t)||u(),0!=i.game_client_point(t,e,s)),game_add_monsters(t){t=c(t)||u(),i.game_add_monsters(t)}},i);function n(t){if(!t)return null;const e=t+new Uint32Array(_.buffer)[t-4>>>2]>>>1,s=new Uint16Array(_.buffer);let i=t>>>1,m="";for(;e-i>1024;)m+=String.fromCharCode(...s.subarray(i,i+=1024));return m+String.fromCharCode(...s.subarray(i,e))}function a(t,e,s){if(!s)return null;const i=function(t){try{return d.getUint32(t,!0)}catch{return d=new DataView(_.buffer),d.getUint32(t,!0)}}(s-4)>>>e,m=new Array(i);for(let _=0;_<i;++_)m[_]=t(s+(_<<e>>>0));return m}class r extends Number{}const h=new FinalizationRegistry((function(t){if(t){const e=l.get(t);if(1===e)i.__unpin(t),l.delete(t);else{if(!e)throw Error(`invalid refcount '${e}' for reference '${t}'`);l.set(t,e-1)}}}));function o(t){if(!t)return null;const e=new r(function(t){if(t){const e=l.get(t);e?l.set(t,e+1):l.set(i.__pin(t),1)}return t}(t));return h.register(e,t),e}function c(t){if(null==t)return 0;if(t instanceof r)return t.valueOf();throw TypeError("internref expected")}const l=new Map;function u(){throw TypeError("value must not be null")}let d=new DataView(_.buffer);function g(t){try{return d.getInt32(t,!0)}catch{return d=new DataView(_.buffer),d.getInt32(t,!0)}}function p(t){try{return d.getFloat32(t,!0)}catch{return d=new DataView(_.buffer),d.getFloat32(t,!0)}}return m}const e=[3,5,8,12,15,20,30,40,50];class s{m_matrix=new Float32Array(9);m_angle=0;m_scale_x=1;m_scale_y=1;constructor(){this.m_matrix[0]=1,this.m_matrix[1]=0,this.m_matrix[2]=0,this.m_matrix[3]=0,this.m_matrix[4]=1,this.m_matrix[5]=0,this.m_matrix[6]=0,this.m_matrix[7]=0,this.m_matrix[8]=1}matrix_array(){return this.m_matrix}set_matrix_array(t){for(let e=0;e<9;e++)this.m_matrix[e]=t[e]}set_translation(t,e){this.m_matrix[2]=t,this.m_matrix[5]=e}translation(){return[this.m_matrix[2],this.m_matrix[5]]}_update_rotation(){this.m_matrix[0]=Math.cos(this.m_angle)*this.m_scale_x,this.m_matrix[3]=Math.sin(this.m_angle)*this.m_scale_x,this.m_matrix[1]=-Math.sin(this.m_angle)*this.m_scale_y,this.m_matrix[4]=Math.cos(this.m_angle)*this.m_scale_y}set_rotation(t){this.m_angle=t,this._update_rotation()}rotation(){return this.m_angle}set_scale(t,e){this.m_scale_x=t,this.m_scale_y=e,this._update_rotation()}set_uniform_scale(t){this.m_scale_x=t,this.m_scale_y=t,this._update_rotation()}multiply(t,e){return[this.m_matrix[0]*t+this.m_matrix[1]*e+this.m_matrix[2],this.m_matrix[3]*t+this.m_matrix[4]*e+this.m_matrix[5]]}multiply_array(t){return this.multiply(t[0],t[1])}apply_scale(t){return t*(Math.sqrt(this.m_matrix[0]*this.m_matrix[0]+this.m_matrix[3]*this.m_matrix[3])+Math.sqrt(this.m_matrix[1]*this.m_matrix[1]+this.m_matrix[4]*this.m_matrix[4]))/2}compose_tfms(t){let e=new s;const i=this.matrix_array(),_=t.matrix_array();let m=[i[0]*_[0]+i[1]*_[3]+i[2]*_[6],i[0]*_[1]+i[1]*_[4]+i[2]*_[7],i[0]*_[2]+i[1]*_[5]+i[2]*_[8],i[3]*_[0]+i[4]*_[3]+i[5]*_[6],i[3]*_[1]+i[4]*_[4]+i[5]*_[7],i[3]*_[2]+i[4]*_[5]+i[5]*_[8],i[6]*_[0]+i[7]*_[3]+i[8]*_[6],i[6]*_[1]+i[7]*_[4]+i[8]*_[7],i[6]*_[2]+i[7]*_[5]+i[8]*_[8]];return e.set_matrix_array(m),e}_det2(t,e,s,i){return t*i-e*s}inverse(){const t=this.m_matrix[0]*this.m_matrix[4]*this.m_matrix[8]+this.m_matrix[2]*this.m_matrix[3]*this.m_matrix[7]+this.m_matrix[1]*this.m_matrix[5]*this.m_matrix[6]-this.m_matrix[2]*this.m_matrix[4]*this.m_matrix[6]-this.m_matrix[0]*this.m_matrix[5]*this.m_matrix[7]-this.m_matrix[1]*this.m_matrix[3]*this.m_matrix[8],e=[this._det2(this.m_matrix[4],this.m_matrix[5],this.m_matrix[7],this.m_matrix[8])/t,-1*this._det2(this.m_matrix[1],this.m_matrix[2],this.m_matrix[7],this.m_matrix[8])/t,this._det2(this.m_matrix[1],this.m_matrix[2],this.m_matrix[4],this.m_matrix[5])/t,-1*this._det2(this.m_matrix[3],this.m_matrix[5],this.m_matrix[6],this.m_matrix[8])/t,this._det2(this.m_matrix[0],this.m_matrix[2],this.m_matrix[6],this.m_matrix[8])/t,-1*this._det2(this.m_matrix[0],this.m_matrix[2],this.m_matrix[3],this.m_matrix[5])/t,this._det2(this.m_matrix[3],this.m_matrix[4],this.m_matrix[6],this.m_matrix[7])/t,-1*this._det2(this.m_matrix[0],this.m_matrix[1],this.m_matrix[6],this.m_matrix[7])/t,this._det2(this.m_matrix[0],this.m_matrix[1],this.m_matrix[3],this.m_matrix[4])/t];let i=new s;return i.set_matrix_array(e),i}toString(){let t="";return t+=this.m_matrix[0]+", "+this.m_matrix[1]+", "+this.m_matrix[2]+"\n",t+=this.m_matrix[3]+", "+this.m_matrix[4]+", "+this.m_matrix[5]+"\n",t+=this.m_matrix[6]+", "+this.m_matrix[7]+", "+this.m_matrix[8],t}}const i="rgba(91, 128, 78, 0.75)",_="rgba(234, 112, 23, 0.5)",m="rgba(48, 148, 233, 0.5)";class n{m_active=!1;m_tfm=new s;m_scale=0;m_scale_index=0;constructor(t,s,i,_,m,n){this.m_context=t,this.m_wtc_tfm=s,this.m_canvas_width=t.canvas.width,this.m_canvas_height=t.canvas.height,this.m_tile_size=i,this.m_vertices=_,this.m_polygons=m,this.m_sizes=n,this.m_scale_index=Math.floor(e.length/2),this._update_scale()}_update_scale(){this.m_scale=e[this.m_scale_index]/this.m_tile_size}toggle_active(){this.m_active=!this.m_active}scale_up(){this.m_active&&(this.m_scale_index++,this.m_scale_index==e.length&&this.m_scale_index--,this._update_scale())}scale_down(){this.m_active&&(this.m_scale_index--,-1==this.m_scale_index&&this.m_scale_index++,this._update_scale())}draw(){if(this.m_context.clearRect(0,0,this.m_canvas_width,this.m_canvas_height),this.m_active){const t=this.m_wtc_tfm.inverse().multiply(this.m_canvas_width/2,this.m_canvas_height/2);this.m_tfm.set_uniform_scale(this.m_scale),this.m_tfm.set_translation(this.m_canvas_width/2-t[0]*this.m_scale,this.m_canvas_height/2-t[1]*this.m_scale),this.m_context.save(),this.m_context.fillStyle=m,this.m_context.strokeStyle=m,this.m_context.lineWidth=.125;let e=0;for(let t=0;t<this.m_sizes.length;t++){const s=this.m_sizes[t];this.m_context.beginPath();for(let t=0;t<s;t++){const s=this.m_polygons[e+t],i=this.m_vertices[3*s],_=this.m_vertices[3*s+2],m=this.m_tfm.multiply(i,_);0==t?this.m_context.moveTo(m[0],m[1]):this.m_context.lineTo(m[0],m[1])}this.m_context.fill(),this.m_context.stroke(),e+=s}this.m_context.beginPath(),this.m_context.fillStyle=i;const s=this.m_tfm.multiply(t[0],t[1]);this.m_context.arc(s[0],s[1],2,0,2*Math.PI),this.m_context.fill(),this.m_context.restore()}}}class a{m_tfm=new s;constructor(){}set_position(t,e){this.m_tfm.set_translation(t,e)}set_angle(t){this.m_tfm.set_rotation(t)}get_tfm(){return this.m_tfm}get_translation(){return this.m_tfm.translation()}}class r extends a{m_active=!1;m_time_accum=0;m_life_time=0;constructor(){super(),this.m_life_time=400}activate(t,e){this.m_tfm.set_translation(t,e),this.m_time_accum=0,this.m_active=!0}get_active(){return this.m_active}get_translation(){return this.m_tfm.translation()}update(t){this.m_active&&(this.m_time_accum+=1e3*t,this.m_time_accum>=this.m_life_time&&this.deactivate())}get_proportion(){return this.m_time_accum/this.m_life_time}deactivate(){this.m_active=!1}}class h extends a{m_tile_size=0;m_type=1;constructor(t,e,s,i){super(),this.set_position(t,e),this.m_tile_size=s,this.m_type=i}get_tile_size(){return this.m_tile_size}get_type(){return this.m_type}}class o extends a{m_radius=0;m_is_move=!1;constructor(){super()}set_radius(t){this.m_radius=t}set_move(t){this.m_is_move=t}get_move(){return this.m_is_move}get_radius(){return this.m_radius}}class c extends o{constructor(){super()}}class l extends o{constructor(){super()}}class u{m_level_width=0;m_level_height=0;m_level_tile_size=0;m_last_click_time=0;m_click_number=0;m_click_cursor=new r;m_level_tiles=new Map;m_player=new c;m_monsters=new Map;constructor(t,e,s){this.m_level_width=t,this.m_level_height=e,this.m_level_tile_size=s}click_position(t,e,s,i,_=!1){const m=performance.now();if(_||m-this.m_last_click_time>(1==this.m_click_number?500:30)){this.m_last_click_time=m,this.m_click_number+=1,this.m_click_number>2&&(this.m_click_number=2);const n=t.game_client_point(e,s,i);return _&&n&&this.m_click_cursor.activate(s,i),n}return!1}reset_click(){this.m_click_number=0}get_click_cursor(){return this.m_click_cursor}get_level_tiles(){return this.m_level_tiles}get_player(){return this.m_player}get_monsters(){return this.m_monsters}delete_tile(t){this.m_level_tiles.has(t)&&this.m_level_tiles.delete(t)}create_tile(t,e,s,i){this.m_level_tiles.set(s,new h(t,e,this.m_level_tile_size,i))}set_player_position(t,e){this.m_player.set_position(t,e)}set_player_radius(t){this.m_player.set_radius(t)}set_player_angle(t){this.m_player.set_angle(t)}set_player_move(t){this.m_player.set_move(t)}set_monster_position(t,e,s){if(this.m_monsters.has(t)){const i=this.m_monsters.get(t);i&&i.set_position(e,s)}else{const i=new l;i.set_position(e,s),this.m_monsters.set(t,i)}}set_monster_radius(t,e){if(this.m_monsters.has(t)){const s=this.m_monsters.get(t);s&&s.set_radius(e)}else{const s=new l;s.set_radius(e),this.m_monsters.set(t,s)}}set_monster_angle(t,e){if(this.m_monsters.has(t)){const s=this.m_monsters.get(t);s&&s.set_angle(e)}else{const s=new l;s.set_angle(e),this.m_monsters.set(t,s)}}set_monster_move(t,e){if(this.m_monsters.has(t)){const s=this.m_monsters.get(t);s&&s.set_move(e)}else{const s=new l;s.set_move(e),this.m_monsters.set(t,s)}}remove_monster(t){this.m_monsters.has(t)&&this.m_monsters.delete(t)}}function d(t,e){const s=t.getBoundingClientRect();return[e.clientX-s.left,e.clientY-s.top]}class g{}class p extends g{constructor(t){super(),this.m_html_element=document.getElementById(t)}show(){this.m_html_element&&(this.m_html_element.style.visibility="visible")}hide(){this.m_html_element&&(this.m_html_element.style.visibility="hidden")}}class v extends p{constructor(t){super(t)}set_text(t){this.m_html_element&&(this.m_html_element.innerText=t)}}class f extends v{m_accumulator=0;m_ticks=0;m_value=0;constructor(t){super(t)}update(t){this.m_accumulator+=t,this.m_ticks+=1,this.m_accumulator>2&&(this.m_value=this.m_ticks/this.m_accumulator,this.m_accumulator=0,this.m_ticks=0,this.set_text((Math.round(100*this.m_value)/100).toFixed(2).toString()))}}class x{constructor(t,e){this.m_total_element=new v(t),this.m_visible_element=new v(e)}update_values(t,e){this.m_total_element&&this.m_total_element.set_text(t.toString()),this.m_visible_element&&this.m_visible_element.set_text(e.toString())}}class y{m_active=!0;assign_fps_element(t){this.m_fps=new f(t)}assign_count_elements(t,e){this.m_items=new x(t,e)}assign_pause_screen(t){this.m_pause_screen=new p(t)}assign_loading(t){this.m_loading=new p(t)}update_count_values(t,e){this.m_items&&this.m_items.update_values(t,e)}on_pause(){this.m_pause_screen.show()}off_pause(){this.m_pause_screen.hide()}loading_hide(){this.m_loading.hide()}update(t){this.m_active&&this.m_fps.update(t)}}class w{m_module=void 0;m_is_start=!1;m_wtc_tfm=new s;m_wtc_scale=1;m_is_mouse_press=!1;m_total_level_entities=0;m_is_game_active=!0;m_is_pause=!1;constructor(){globalThis.host={define_level:this.define_level.bind(this),define_navmesh:this.define_navmesh.bind(this),define_total_tiles:this.define_total_tiles.bind(this),tile_delete:this.tile_delete.bind(this),tile_create:this.tile_create.bind(this),create_player:this.create_player.bind(this),define_player_changes:this.define_player_changes.bind(this),create_monster:this.create_monster.bind(this),define_monster_changes:this.define_monster_changes.bind(this),remove_monster:this.remove_monster.bind(this),define_total_update_entities:this.define_total_update_entities.bind(this),debug_entity_walk_path:this.debug_entity_walk_path.bind(this),debug_close_entity:this.debug_close_entity.bind(this)},this.m_ui=new y,this.m_ui.assign_fps_element("fps"),this.m_ui.assign_count_elements("level_count","visible_count"),this.m_ui.assign_pause_screen("pause"),this.m_ui.assign_loading("loading"),this.m_scene_canvas=document.getElementById("canvas"),this.m_scene_ctx=this.m_scene_canvas.getContext("2d"),this.m_map_canvas=document.getElementById("map_canvas"),this.m_map_ctx=this.m_map_canvas.getContext("2d"),this.m_map_canvas.style.pointerEvents="none",this.m_current_time=performance.now(),window.addEventListener("contextmenu",(t=>t.preventDefault()));const e=this;document.onkeydown=function(t){e.key_event(t.key)},this.m_scene_canvas.addEventListener("mousedown",(function(t){e.mouse_press_event(t)})),this.m_scene_canvas.addEventListener("mouseup",(function(t){e.mouse_release_event(t)})),document.onmousemove=function(t){e.m_mouse_event=t},document.addEventListener("visibilitychange",(function(){e.visibilitychange_event()})),fetch("/games/ProjectH/build/game_api.wasm").then((t=>WebAssembly.compileStreaming(t))).then((s=>t(s,{env:{}}).then((t=>{e.m_module=t,console.log("finish to load the module:",(performance.now()-e.m_current_time)/1e3,"seconds"),e.m_current_time=performance.now();const s=t.create_settings(),i=Math.floor(4294967295*Math.random());console.log("seed:",i),t.settings_set_seed(s,i),t.settings_set_rvo_time_horizon(s,1),t.settings_set_neighborhood_quad_size(s,1),t.settings_set_generate(s,22,2,4,10),t.settings_set_use_debug(s,!1),t.settings_set_debug_flags(s,!0,!1),e.m_game_ptr=t.create_game(s),console.log("generate the level:",(performance.now()-e.m_current_time)/1e3,"seconds"),e.m_current_time=performance.now(),e.start(),e.m_is_start=!0,e.m_ui.off_pause(),e.m_ui.loading_hide()}))))}visibilitychange_event(){document.hidden?this.deactivate():this.m_is_pause||this.activate()}activate(){this.m_is_game_active=!0,this.m_current_time=performance.now(),this.m_ui.off_pause()}deactivate(){this.m_is_game_active=!1,this.m_ui.on_pause()}toggle_activate(){this.m_is_game_active?(this.deactivate(),this.m_is_pause=!0):(this.activate(),this.m_is_pause=!1)}mouse_press_event(t){if(this.m_mouse_event=t,this.m_is_start&&this.m_is_game_active){this.m_is_mouse_press=!0;const e=d(this.m_scene_canvas,t),s=this.point_to_world(e[0],e[1]);this.m_scene.click_position(this.m_module,this.m_game_ptr,s[0],s[1],!0)&&this.mouse_click(e[0],e[1],s[0],s[1])}}mouse_release_event(t){this.m_is_start&&(this.m_is_mouse_press=!1,this.m_scene.reset_click())}key_event(t){this.m_is_start&&("Escape"==t?this.toggle_activate():this.m_is_game_active&&("s"==t?this.m_module.game_add_monsters(this.m_game_ptr):"m"==t?this.m_map.toggle_active():"+"==t?this.m_map.scale_up():"-"==t&&this.m_map.scale_down()))}update(){if(this.m_is_game_active){if(this.m_is_mouse_press&&this.m_mouse_event&&this.m_scene_canvas){const t=d(this.m_scene_canvas,this.m_mouse_event),e=this.point_to_world(t[0],t[1]);this.m_scene.click_position(this.m_module,this.m_game_ptr,e[0],e[1])}const t=performance.now(),e=(t-this.m_current_time)/1e3;this.m_current_time=t,this.m_module&&this.m_module.game_update(this.m_game_ptr,e),this.m_scene.get_click_cursor().update(e),this.m_ui.update(e),this.m_ui.update_count_values(this.m_total_level_entities,this.m_scene.get_monsters().size)}this.draw_map()}draw_map(){this.m_map&&this.m_map.draw()}define_level(t,e,s){this.m_level_width=t,this.m_level_height=e,this.m_level_tile_size=s,this.m_scene=new u(this.m_level_width,this.m_level_height,this.m_level_tile_size),this.m_wtc_scale=50/this.m_level_tile_size,this.m_wtc_tfm.set_uniform_scale(this.m_wtc_scale)}define_navmesh(t,e,s){this.m_map=new n(this.m_map_ctx,this.m_wtc_tfm,this.m_level_tile_size,t,e,s)}define_total_tiles(t){}tile_delete(t){this.m_scene.delete_tile(t),this.scene_tile_delete(t)}tile_create(t,e,s,i){const _=t*this.m_level_tile_size,m=e*this.m_level_tile_size;this.m_scene.create_tile(_,m,s,i),this.scene_tile_create(_,m,s,i)}create_player(t){this.m_scene.set_player_radius(t),this.scene_create_player(t)}define_player_changes(t,e,s,i){this.m_scene.set_player_position(t,e),this.m_scene.set_player_angle(s),this.m_scene.set_player_move(i),this.scene_define_player_changes(t,e,s,i)}create_monster(t,e){this.m_scene.set_monster_radius(t,e),this.scene_create_monster(t,e)}define_monster_changes(t,e,s,i,_){this.m_scene.set_monster_position(t,e,s),this.m_scene.set_monster_angle(t,i),this.m_scene.set_monster_move(t,_),this.scene_define_monster_changes(t,e,s,i,_)}remove_monster(t){this.m_scene.remove_monster(t),this.scene_remove_monster(t)}define_total_update_entities(t){this.m_total_level_entities=t}debug_entity_walk_path(t,e){const s=new Float32Array(e.length);for(let t=0;t<s.length;t++)s[t]=e[t];this.debug_entity_trajectory(t,s)}debug_close_entity(t,e,s,i,_,m){this.debug_close_entity_pair(t,e,s,i,_,m)}}function b(t,e,s){if(s.get_active()){const i=Math.pow(Math.min(s.get_proportion(),1),.15);t.save(),t.lineWidth=1,t.fillStyle="rgba(232, 128, 51, 0.25)",t.strokeStyle=_,t.beginPath();const m=e.multiply_array(s.get_translation()),n=e.apply_scale(.5)*i;t.arc(m[0],m[1],n,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.fillStyle=_,t.arc(m[0],m[1],2,0,2*Math.PI),t.fill(),t.restore()}}function k(t,e,s){const i=e.multiply_array(s.get_translation()),_=e.apply_scale(s.get_tile_size()),m=s.get_type();t.save(),t.lineWidth=.2,t.fillStyle="rgb(192, 192, 192)",t.strokeStyle="rgb(152, 152, 152)",t.beginPath(),0==m?t.rect(i[0],i[1],_,_):2==m?t.rect(i[0]+_/2,i[1]+_/2,_/2,_/2):3==m?t.rect(i[0],i[1]+_/2,_/2,_/2):4==m?t.rect(i[0]+_/2,i[1],_/2,_/2):5==m?t.rect(i[0],i[1],_/2,_/2):6==m?t.rect(i[0],i[1]+_/2,_,_/2):7==m?t.rect(i[0],i[1],_/2,_):8==m?t.rect(i[0],i[1],_,_/2):9==m?t.rect(i[0]+_/2,i[1],_/2,_):10==m?(t.moveTo(i[0],i[1]),t.lineTo(i[0],i[1]+_),t.lineTo(i[0]+_/2,i[1]+_),t.lineTo(i[0]+_/2,i[1]+_/2),t.lineTo(i[0]+_,i[1]+_/2),t.lineTo(i[0]+_,i[1])):11==m?(t.moveTo(i[0],i[1]),t.lineTo(i[0],i[1]+_/2),t.lineTo(i[0]+_/2,i[1]+_/2),t.lineTo(i[0]+_/2,i[1]+_),t.lineTo(i[0]+_,i[1]+_),t.lineTo(i[0]+_,i[1])):12==m?(t.moveTo(i[0],i[1]),t.lineTo(i[0],i[1]+_),t.lineTo(i[0]+_,i[1]+_),t.lineTo(i[0]+_,i[1]+_/2),t.lineTo(i[0]+_/2,i[1]+_/2),t.lineTo(i[0]+_/2,i[1])):13==m&&(t.moveTo(i[0],i[1]+_/2),t.lineTo(i[0],i[1]+_),t.lineTo(i[0]+_,i[1]+_),t.lineTo(i[0]+_,i[1]),t.lineTo(i[0]+_/2,i[1]),t.lineTo(i[0]+_/2,i[1]+_/2)),t.fill(),t.stroke(),t.restore()}function T(t,e,s,i,_,m,n,a){t.save(),t.lineWidth=i,t.fillStyle=s.get_move()?_:m,t.strokeStyle=n,t.beginPath();const r=s.get_tfm(),h=e.compose_tfms(r),o=h.multiply(0,0),c=s.get_radius(),l=h.apply_scale(c),u=h.multiply(c*Math.SQRT2,0),d=r.rotation();t.arc(o[0],o[1],l,d+Math.PI/4,2*Math.PI+d-Math.PI/4),t.lineTo(u[0],u[1]),t.fill(),a&&t.stroke(),t.restore()}function z(t,e,s){T(t,e,s,1,"rgba(91, 128, 78, 0.5)",i,"rgb(74, 193, 33)",false)}function M(t,e,s){T(t,e,s,1,"rgba(196, 94, 45, 0.5)","rgba(196, 94, 45, 0.75)","rgb(226, 55, 27)",false)}function S(t,e,s){t.save(),t.lineWidth=1,t.strokeStyle="rgb(94, 178, 219)",t.beginPath();const i=s.length/2,_=e.multiply(s[0],s[1]);t.moveTo(_[0],_[1]);for(let _=1;_<i;_++){const i=e.multiply(s[2*_],s[2*_+1]);t.lineTo(i[0],i[1])}t.stroke(),t.restore()}function P(t,e,s){t.save(),t.lineWidth=1,t.strokeStyle="rgb(82, 209, 77)",t.beginPath();const i=s.length/4;for(let _=0;_<i;_++){const i=e.multiply(s[4*_],s[4*_+1]),m=e.multiply(s[4*_+2],s[4*_+3]);t.moveTo(i[0],i[1]),t.lineTo(m[0],m[1])}t.stroke(),t.restore()}new class extends w{m_camera_position_x=0;m_camera_position_y=0;m_debug_trajectories=new Map;constructor(){super(),this.m_canvas_width=this.m_scene_canvas.width,this.m_canvas_height=this.m_scene_canvas.height,this.m_debug_trajectories.clear(),this.m_debug_pairs=new Array}start(){this.update_process()}point_to_world(t,e){return this.m_wtc_tfm.inverse().multiply(t,e)}scene_tile_delete(t){}scene_tile_create(t,e,s,i){}scene_create_player(t){}mouse_click(t,e,s,i){}scene_define_player_changes(t,e,s,i){this.m_camera_position_x=1*t+0*this.m_camera_position_x,this.m_camera_position_y=1*e+0*this.m_camera_position_y,this.m_wtc_tfm.set_translation(this.m_canvas_width/2-this.m_camera_position_x*this.m_wtc_scale,this.m_canvas_height/2-this.m_camera_position_y*this.m_wtc_scale)}scene_create_monster(t,e){}scene_define_monster_changes(t,e,s,i,_){}scene_remove_monster(t){}debug_entity_trajectory(t,e){this.m_debug_trajectories.set(t,e)}debug_close_entity_pair(t,e,s,i,_,m){this.m_debug_pairs.push(e),this.m_debug_pairs.push(s),this.m_debug_pairs.push(_),this.m_debug_pairs.push(m)}update_process(){this.m_debug_trajectories.clear(),this.m_debug_pairs.length=0,this.update(),this.draw_scene(),window.requestAnimationFrame(this.update_process.bind(this))}draw_scene(){var t,e,s;this.m_scene_ctx.clearRect(0,0,this.m_canvas_width,this.m_canvas_height),t=this.m_scene_ctx,e=this.m_scene_canvas.width,s=this.m_scene_canvas.height,t.save(),t.fillStyle="rgb(64, 64, 64)",t.fillRect(0,0,e,s),t.restore();const i=this.m_scene.get_level_tiles();for(let[t,e]of i)k(this.m_scene_ctx,this.m_wtc_tfm,e);const _=this.m_scene.get_click_cursor();b(this.m_scene_ctx,this.m_wtc_tfm,_);const m=this.m_scene.get_player();z(this.m_scene_ctx,this.m_wtc_tfm,m);const n=this.m_scene.get_monsters();for(let[t,e]of n)M(this.m_scene_ctx,this.m_wtc_tfm,e);for(let[t,e]of this.m_debug_trajectories)S(this.m_scene_ctx,this.m_wtc_tfm,e);P(this.m_scene_ctx,this.m_wtc_tfm,this.m_debug_pairs)}};
//# sourceMappingURL=module.js.map
