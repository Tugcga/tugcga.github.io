async function t(t,e={}){const s={env:Object.assign(Object.create(globalThis),e.env||{},{abort(t,e,s,i){t=m(t>>>0),e=m(e>>>0),s>>>=0,i>>>=0,(()=>{throw Error(`${t} in ${e}:${s}:${i}`)})()},"host.define_level"(t,e,s){t>>>=0,e>>>=0,host.define_level(t,e,s)},"host.define_total_tiles"(t){t>>>=0,host.define_total_tiles(t)},"host.define_navmesh"(t,e,s){t=a(p,2,t>>>0),e=a(g,2,e>>>0),s=a(g,2,s>>>0),host.define_navmesh(t,e,s)},"host.create_player"(t,e){t>>>=0,host.create_player(t,e)},"host.define_entity_changes"(t,e,s,i,_){t>>>=0,_>>>=0,host.define_entity_changes(t,e,s,i,_)},"host.entity_start_action"(t,e){t>>>=0,e>>>=0,host.entity_start_action(t,e)},"host.define_total_update_entities"(t){t>>>=0,host.define_total_update_entities(t)},"host.debug_entity_walk_path"(t,e){t>>>=0,e=a(p,2,e>>>0),host.debug_entity_walk_path(t,e)},"host.debug_close_entity"(t,e,s,i,_,n){t>>>=0,i>>>=0,host.debug_close_entity(t,e,s,i,_,n)},"host.debug_visible_quad"(t,e,s,i){host.debug_visible_quad(t,e,s,i)},"host.debug_neighborhood_quad"(t,e,s,i){host.debug_neighborhood_quad(t,e,s,i)},"host.tile_delete"(t){t>>>=0,host.tile_delete(t)},"host.tile_create"(t,e,s,i){t>>>=0,e>>>=0,s>>>=0,i>>>=0,host.tile_create(t,e,s,i)},"host.remove_monster"(t){t>>>=0,host.remove_monster(t)},"host.create_monster"(t,e){t>>>=0,host.create_monster(t,e)},"host.entity_finish_action"(t,e){t>>>=0,e>>>=0,host.entity_finish_action(t,e)},"host.entity_start_cooldawn"(t,e,s){t>>>=0,e>>>=0,host.entity_start_cooldawn(t,e,s)}})},{exports:i}=await WebAssembly.instantiate(t,s),_=i.memory||e.env.memory,n=Object.setPrototypeOf({create_settings:()=>o(i.create_settings()>>>0),settings_set_seed(t,e){t=l(t)||d(),i.settings_set_seed(t,e)},settings_set_generate(t,e,s,_,n){t=l(t)||d(),i.settings_set_generate(t,e,s,_,n)},settings_set_use_debug(t,e){t=l(t)||d(),e=e?1:0,i.settings_set_use_debug(t,e)},settings_set_debug_flags(t,e,s,_,n){t=l(t)||d(),e=e?1:0,s=s?1:0,_=_?1:0,n=n?1:0,i.settings_set_debug_flags(t,e,s,_,n)},settings_set_neighborhood_quad_size(t,e){t=l(t)||d(),i.settings_set_neighborhood_quad_size(t,e)},settings_set_rvo_time_horizon(t,e){t=l(t)||d(),i.settings_set_rvo_time_horizon(t,e)},settings_set_use_rvo(t,e){t=l(t)||d(),e=e?1:0,i.settings_set_use_rvo(t,e)},settings_set_snap_to_navmesh(t,e){t=l(t)||d(),e=e?1:0,i.settings_set_snap_to_navmesh(t,e)},settings_set_velocity_boundary_control(t,e){t=l(t)||d(),e=e?1:0,i.settings_set_velocity_boundary_control(t,e)},settings_set_path_recalculate_time(t,e){t=l(t)||d(),i.settings_set_path_recalculate_time(t,e)},settings_set_player_fast_shift(t,e,s,_){t=l(t)||d(),i.settings_set_player_fast_shift(t,e,s,_)},create_game:t=>(t=l(t)||d(),o(i.create_game(t)>>>0)),game_update(t,e){t=l(t)||d(),i.game_update(t,e)},game_client_point:(t,e,s)=>(t=l(t)||d(),0!=i.game_client_point(t,e,s)),game_client_shift(t,e,s){t=l(t)||d(),i.game_client_shift(t,e,s)},game_add_monsters(t){t=l(t)||d(),i.game_add_monsters(t)}},i);function m(t){if(!t)return null;const e=t+new Uint32Array(_.buffer)[t-4>>>2]>>>1,s=new Uint16Array(_.buffer);let i=t>>>1,n="";for(;e-i>1024;)n+=String.fromCharCode(...s.subarray(i,i+=1024));return n+String.fromCharCode(...s.subarray(i,e))}function a(t,e,s){if(!s)return null;const i=function(t){try{return u.getUint32(t,!0)}catch{return u=new DataView(_.buffer),u.getUint32(t,!0)}}(s-4)>>>e,n=new Array(i);for(let _=0;_<i;++_)n[_]=t(s+(_<<e>>>0));return n}class r extends Number{}const h=new FinalizationRegistry((function(t){if(t){const e=c.get(t);if(1===e)i.__unpin(t),c.delete(t);else{if(!e)throw Error(`invalid refcount '${e}' for reference '${t}'`);c.set(t,e-1)}}}));function o(t){if(!t)return null;const e=new r(function(t){if(t){const e=c.get(t);e?c.set(t,e+1):c.set(i.__pin(t),1)}return t}(t));return h.register(e,t),e}function l(t){if(null==t)return 0;if(t instanceof r)return t.valueOf();throw TypeError("internref expected")}const c=new Map;function d(){throw TypeError("value must not be null")}let u=new DataView(_.buffer);function g(t){try{return u.getInt32(t,!0)}catch{return u=new DataView(_.buffer),u.getInt32(t,!0)}}function p(t){try{return u.getFloat32(t,!0)}catch{return u=new DataView(_.buffer),u.getFloat32(t,!0)}}return n}const e=[3,5,8,12,15,20,30,40,50];let s;var i;let _;var n;let m;var a;(i=s||(s={}))[i.NONE=0]="NONE",i[i.WALK=1]="WALK",i[i.SHIFT=2]="SHIFT",(n=_||(_={}))[n.SHIFT=0]="SHIFT",(a=m||(m={}))[a.SHIFT=0]="SHIFT";class r{m_matrix=new Float32Array(9);m_angle=0;m_scale_x=1;m_scale_y=1;constructor(){this.m_matrix[0]=1,this.m_matrix[1]=0,this.m_matrix[2]=0,this.m_matrix[3]=0,this.m_matrix[4]=1,this.m_matrix[5]=0,this.m_matrix[6]=0,this.m_matrix[7]=0,this.m_matrix[8]=1}matrix_array(){return this.m_matrix}set_matrix_array(t){for(let e=0;e<9;e++)this.m_matrix[e]=t[e]}set_translation(t,e){this.m_matrix[2]=t,this.m_matrix[5]=e}translation(){return[this.m_matrix[2],this.m_matrix[5]]}_update_rotation(){this.m_matrix[0]=Math.cos(this.m_angle)*this.m_scale_x,this.m_matrix[3]=Math.sin(this.m_angle)*this.m_scale_x,this.m_matrix[1]=-Math.sin(this.m_angle)*this.m_scale_y,this.m_matrix[4]=Math.cos(this.m_angle)*this.m_scale_y}set_rotation(t){this.m_angle=t,this._update_rotation()}rotation(){return this.m_angle}set_scale(t,e){this.m_scale_x=t,this.m_scale_y=e,this._update_rotation()}set_uniform_scale(t){this.m_scale_x=t,this.m_scale_y=t,this._update_rotation()}multiply(t,e){return[this.m_matrix[0]*t+this.m_matrix[1]*e+this.m_matrix[2],this.m_matrix[3]*t+this.m_matrix[4]*e+this.m_matrix[5]]}multiply_array(t){return this.multiply(t[0],t[1])}apply_scale(t){return t*(Math.sqrt(this.m_matrix[0]*this.m_matrix[0]+this.m_matrix[3]*this.m_matrix[3])+Math.sqrt(this.m_matrix[1]*this.m_matrix[1]+this.m_matrix[4]*this.m_matrix[4]))/2}compose_tfms(t){let e=new r;const s=this.matrix_array(),i=t.matrix_array();let _=[s[0]*i[0]+s[1]*i[3]+s[2]*i[6],s[0]*i[1]+s[1]*i[4]+s[2]*i[7],s[0]*i[2]+s[1]*i[5]+s[2]*i[8],s[3]*i[0]+s[4]*i[3]+s[5]*i[6],s[3]*i[1]+s[4]*i[4]+s[5]*i[7],s[3]*i[2]+s[4]*i[5]+s[5]*i[8],s[6]*i[0]+s[7]*i[3]+s[8]*i[6],s[6]*i[1]+s[7]*i[4]+s[8]*i[7],s[6]*i[2]+s[7]*i[5]+s[8]*i[8]];return e.set_matrix_array(_),e}_det2(t,e,s,i){return t*i-e*s}inverse(){const t=this.m_matrix[0]*this.m_matrix[4]*this.m_matrix[8]+this.m_matrix[2]*this.m_matrix[3]*this.m_matrix[7]+this.m_matrix[1]*this.m_matrix[5]*this.m_matrix[6]-this.m_matrix[2]*this.m_matrix[4]*this.m_matrix[6]-this.m_matrix[0]*this.m_matrix[5]*this.m_matrix[7]-this.m_matrix[1]*this.m_matrix[3]*this.m_matrix[8],e=[this._det2(this.m_matrix[4],this.m_matrix[5],this.m_matrix[7],this.m_matrix[8])/t,-1*this._det2(this.m_matrix[1],this.m_matrix[2],this.m_matrix[7],this.m_matrix[8])/t,this._det2(this.m_matrix[1],this.m_matrix[2],this.m_matrix[4],this.m_matrix[5])/t,-1*this._det2(this.m_matrix[3],this.m_matrix[5],this.m_matrix[6],this.m_matrix[8])/t,this._det2(this.m_matrix[0],this.m_matrix[2],this.m_matrix[6],this.m_matrix[8])/t,-1*this._det2(this.m_matrix[0],this.m_matrix[2],this.m_matrix[3],this.m_matrix[5])/t,this._det2(this.m_matrix[3],this.m_matrix[4],this.m_matrix[6],this.m_matrix[7])/t,-1*this._det2(this.m_matrix[0],this.m_matrix[1],this.m_matrix[6],this.m_matrix[7])/t,this._det2(this.m_matrix[0],this.m_matrix[1],this.m_matrix[3],this.m_matrix[4])/t];let s=new r;return s.set_matrix_array(e),s}toString(){let t="";return t+=this.m_matrix[0]+", "+this.m_matrix[1]+", "+this.m_matrix[2]+"\n",t+=this.m_matrix[3]+", "+this.m_matrix[4]+", "+this.m_matrix[5]+"\n",t+=this.m_matrix[6]+", "+this.m_matrix[7]+", "+this.m_matrix[8],t}}const h="rgba(91, 128, 78, 0.75)",o="rgba(234, 112, 23, 0.5)",l="rgba(48, 148, 233, 0.5)";class c{m_active=!1;m_tfm=new r;m_scale=0;m_scale_index=0;constructor(t,s,i,_,n,m){this.m_context=t,this.m_wtc_tfm=s,this.m_canvas_width=t.canvas.width,this.m_canvas_height=t.canvas.height,this.m_tile_size=i,this.m_vertices=_,this.m_polygons=n,this.m_sizes=m,this.m_scale_index=Math.floor(e.length/2),this._update_scale()}_update_scale(){this.m_scale=e[this.m_scale_index]/this.m_tile_size}toggle_active(){this.m_active=!this.m_active}scale_up(){this.m_active&&(this.m_scale_index++,this.m_scale_index==e.length&&this.m_scale_index--,this._update_scale())}scale_down(){this.m_active&&(this.m_scale_index--,-1==this.m_scale_index&&this.m_scale_index++,this._update_scale())}draw(){if(this.m_context.clearRect(0,0,this.m_canvas_width,this.m_canvas_height),this.m_active){const t=this.m_wtc_tfm.inverse().multiply(this.m_canvas_width/2,this.m_canvas_height/2);this.m_tfm.set_uniform_scale(this.m_scale),this.m_tfm.set_translation(this.m_canvas_width/2-t[0]*this.m_scale,this.m_canvas_height/2-t[1]*this.m_scale),this.m_context.save(),this.m_context.fillStyle=l,this.m_context.strokeStyle=l,this.m_context.lineWidth=.125;let e=0;for(let t=0;t<this.m_sizes.length;t++){const s=this.m_sizes[t];this.m_context.beginPath();for(let t=0;t<s;t++){const s=this.m_polygons[e+t],i=this.m_vertices[3*s],_=this.m_vertices[3*s+2],n=this.m_tfm.multiply(i,_);0==t?this.m_context.moveTo(n[0],n[1]):this.m_context.lineTo(n[0],n[1])}this.m_context.fill(),this.m_context.stroke(),e+=s}this.m_context.beginPath(),this.m_context.fillStyle=h;const s=this.m_tfm.multiply(t[0],t[1]);this.m_context.arc(s[0],s[1],2,0,2*Math.PI),this.m_context.fill(),this.m_context.restore()}}}class d{m_tfm=new r;constructor(){}set_position(t,e){this.m_tfm.set_translation(t,e)}set_angle(t){this.m_tfm.set_rotation(t)}get_tfm(){return this.m_tfm}get_translation(){return this.m_tfm.translation()}}class u extends d{m_active=!1;m_time_accum=0;m_life_time=0;constructor(){super(),this.m_life_time=400}activate(t,e){this.m_tfm.set_translation(t,e),this.m_time_accum=0,this.m_active=!0}get_active(){return this.m_active}get_translation(){return this.m_tfm.translation()}update(t){this.m_active&&(this.m_time_accum+=1e3*t,this.m_time_accum>=this.m_life_time&&this.deactivate())}get_proportion(){return this.m_time_accum/this.m_life_time}deactivate(){this.m_active=!1}}class g extends d{m_tile_size=0;m_type=1;constructor(t,e,s,i){super(),this.set_position(t,e),this.m_tile_size=s,this.m_type=i}get_tile_size(){return this.m_tile_size}get_type(){return this.m_type}}class p extends d{m_entity_id=-1;m_radius=0;m_move_status=s.NONE;constructor(t){super(),this.m_entity_id=t}set_id(t){this.m_entity_id=t}get_id(){return this.m_entity_id}set_radius(t){this.m_radius=t}set_move(t){this.m_move_status=t}get_move(){return this.m_move_status}get_radius(){return this.m_radius}}class v extends p{constructor(t){super(t)}}class f extends p{constructor(t){super(t)}}class y{m_cooldawns=new Map;add_entity(t){this.m_cooldawns.set(t,new Map)}remove_entity(t){this.m_cooldawns.delete(t)}start_cooldawn(t,e,s){this.m_cooldawns.get(t)?.set(e,[s,0])}update(t){this.m_cooldawns.forEach(((e,s)=>{e.forEach(((s,i)=>{s[1]+=t,s[1]>=s[0]&&e.delete(i)}))}))}get_cooldawns(t){const e=this.m_cooldawns.get(t);return e||new Map}}class b{m_level_width=0;m_level_height=0;m_level_tile_size=0;m_last_click_time=0;m_click_number=0;m_click_cursor=new u;m_level_tiles=new Map;m_player=new v(0);m_player_id=0;m_monsters=new Map;m_cooldawns=new y;constructor(t,e,s){this.m_level_width=t,this.m_level_height=e,this.m_level_tile_size=s}click_position(t,e,s,i,_=!1){const n=performance.now();if(_||n-this.m_last_click_time>(1==this.m_click_number?500:30)){this.m_last_click_time=n,this.m_click_number+=1,this.m_click_number>2&&(this.m_click_number=2);const m=t.game_client_point(e,s,i);return _&&m&&this.m_click_cursor.activate(s,i),m}return!1}reset_click(){this.m_click_number=0}get_click_cursor(){return this.m_click_cursor}get_cooldawns(){return this.m_cooldawns}get_person_cooldawns(t){return this.m_cooldawns.get_cooldawns(t)}get_level_tiles(){return this.m_level_tiles}get_player(){return this.m_player}get_monsters(){return this.m_monsters}delete_tile(t){this.m_level_tiles.has(t)&&this.m_level_tiles.delete(t)}create_tile(t,e,s,i){this.m_level_tiles.set(s,new g(t,e,this.m_level_tile_size,i))}set_player_id(t){this.m_player_id=t,this.m_player.set_id(t),this.m_cooldawns.add_entity(t)}is_player(t){return this.m_player_id==t}set_player_radius(t){this.m_player.set_radius(t)}set_entity_position(t,e,s){if(t==this.m_player_id)this.m_player.set_position(e,s);else if(this.m_monsters.has(t)){const i=this.m_monsters.get(t);i&&i.set_position(e,s)}else{const i=new f(t);i.set_position(e,s),this.m_monsters.set(t,i)}}set_monster_radius(t,e){if(this.m_monsters.has(t)){const s=this.m_monsters.get(t);s&&s.set_radius(e)}else{const s=new f(t);s.set_radius(e),this.m_cooldawns.add_entity(t),this.m_monsters.set(t,s)}}set_entity_angle(t,e){if(t==this.m_player_id)this.m_player.set_angle(e);else if(this.m_monsters.has(t)){const s=this.m_monsters.get(t);s&&s.set_angle(e)}else{const s=new f(t);s.set_angle(e),this.m_cooldawns.add_entity(t),this.m_monsters.set(t,s)}}set_entity_move(t,e){if(t==this.m_player_id)this.m_player.set_move(e);else if(this.m_monsters.has(t)){const s=this.m_monsters.get(t);s&&s.set_move(e)}else{const s=new f(t);s.set_move(e),this.m_cooldawns.add_entity(t),this.m_monsters.set(t,s)}}remove_monster(t){this.m_monsters.has(t)&&this.m_monsters.delete(t),this.m_cooldawns.remove_entity(t)}}function x(t,e){const s=t.getBoundingClientRect();return[e.clientX-s.left,e.clientY-s.top]}class w{}class k extends w{constructor(t){super(),this.m_html_element=document.getElementById(t)}show(){this.m_html_element&&(this.m_html_element.style.visibility="visible")}hide(){this.m_html_element&&(this.m_html_element.style.visibility="hidden")}}class T extends k{constructor(t){super(t)}set_text(t){this.m_html_element&&(this.m_html_element.innerText=t)}}class S extends T{m_accumulator=0;m_ticks=0;m_value=0;constructor(t){super(t)}update(t){this.m_accumulator+=t,this.m_ticks+=1,this.m_accumulator>2&&(this.m_value=this.m_ticks/this.m_accumulator,this.m_accumulator=0,this.m_ticks=0,this.set_text((Math.round(100*this.m_value)/100).toFixed(2).toString()))}}class M{constructor(t,e){this.m_total_element=new T(t),this.m_visible_element=new T(e)}update_values(t,e){this.m_total_element&&this.m_total_element.set_text(t.toString()),this.m_visible_element&&this.m_visible_element.set_text(e.toString())}}class z{m_active=!0;assign_fps_element(t){this.m_fps=new S(t)}assign_count_elements(t,e){this.m_items=new M(t,e)}assign_pause_screen(t){this.m_pause_screen=new k(t)}assign_loading(t){this.m_loading=new k(t)}update_count_values(t,e){this.m_items&&this.m_items.update_values(t,e)}on_pause(){this.m_pause_screen.show()}off_pause(){this.m_pause_screen.hide()}loading_hide(){this.m_loading.hide()}update(t){this.m_active&&this.m_fps.update(t)}}class P{m_module=void 0;m_is_start=!1;m_wtc_tfm=new r;m_wtc_scale=1;m_is_mouse_press=!1;m_total_level_entities=0;m_is_game_active=!0;m_is_pause=!1;constructor(){globalThis.host={define_level:this.define_level.bind(this),define_navmesh:this.define_navmesh.bind(this),define_total_tiles:this.define_total_tiles.bind(this),tile_delete:this.tile_delete.bind(this),tile_create:this.tile_create.bind(this),create_player:this.create_player.bind(this),create_monster:this.create_monster.bind(this),define_entity_changes:this.define_entity_changes.bind(this),remove_monster:this.remove_monster.bind(this),define_total_update_entities:this.define_total_update_entities.bind(this),entity_start_action:this.entity_start_action.bind(this),entity_finish_action:this.entity_finish_action.bind(this),entity_start_cooldawn:this.entity_start_cooldawn.bind(this),debug_entity_walk_path:this.debug_entity_walk_path.bind(this),debug_close_entity:this.debug_close_entity.bind(this),debug_visible_quad:this.debug_visible_quad.bind(this),debug_neighborhood_quad:this.debug_neighborhood_quad.bind(this)},this.m_ui=new z,this.m_ui.assign_fps_element("fps"),this.m_ui.assign_count_elements("level_count","visible_count"),this.m_ui.assign_pause_screen("pause"),this.m_ui.assign_loading("loading"),this.m_scene_canvas=document.getElementById("canvas"),this.m_scene_ctx=this.m_scene_canvas.getContext("2d"),this.m_map_canvas=document.getElementById("map_canvas"),this.m_map_ctx=this.m_map_canvas.getContext("2d"),this.m_map_canvas.style.pointerEvents="none",this.m_current_time=performance.now(),window.addEventListener("contextmenu",(t=>t.preventDefault()));const e=this;document.onkeydown=function(t){return e.key_event(t.key),!(" "==t.key)},this.m_scene_canvas.addEventListener("mousedown",(function(t){e.mouse_press_event(t)})),this.m_scene_canvas.addEventListener("mouseup",(function(t){e.mouse_release_event(t)})),document.onmousemove=function(t){e.m_mouse_event=t},document.addEventListener("visibilitychange",(function(){e.visibilitychange_event()})),fetch("/games/ProjectH/build/game_api.wasm").then((t=>WebAssembly.compileStreaming(t))).then((s=>t(s,{env:{}}).then((t=>{e.m_module=t,console.log("finish to load the module:",(performance.now()-e.m_current_time)/1e3,"seconds"),e.m_current_time=performance.now();const s=t.create_settings();Math.floor(4294967295*Math.random());t.settings_set_rvo_time_horizon(s,1),t.settings_set_neighborhood_quad_size(s,1),t.settings_set_generate(s,22,2,4,10),t.settings_set_use_debug(s,!1),t.settings_set_debug_flags(s,!0,!0,!0,!0),t.settings_set_snap_to_navmesh(s,!0),t.settings_set_use_rvo(s,!0),t.settings_set_path_recalculate_time(s,1),t.settings_set_velocity_boundary_control(s,!0),t.settings_set_player_fast_shift(s,2,5,.5),e.m_game_ptr=t.create_game(s),console.log("generate the level:",(performance.now()-e.m_current_time)/1e3,"seconds"),e.m_current_time=performance.now(),e.start(),e.m_is_start=!0,e.m_ui.off_pause(),e.m_ui.loading_hide()}))))}visibilitychange_event(){document.hidden?this.deactivate():this.m_is_pause||this.activate()}activate(){this.m_is_game_active=!0,this.m_current_time=performance.now(),this.m_ui.off_pause()}deactivate(){this.m_is_game_active=!1,this.m_ui.on_pause()}toggle_activate(){this.m_is_game_active?(this.deactivate(),this.m_is_pause=!0):(this.activate(),this.m_is_pause=!1)}mouse_press_event(t){if(this.m_mouse_event=t,this.m_is_start&&this.m_is_game_active){this.m_is_mouse_press=!0;const e=x(this.m_scene_canvas,t),s=this.point_to_world(e[0],e[1]);this.m_scene.click_position(this.m_module,this.m_game_ptr,s[0],s[1],!0)&&this.mouse_click(e[0],e[1],s[0],s[1])}}mouse_release_event(t){this.m_is_start&&(this.m_is_mouse_press=!1,this.m_scene.reset_click())}key_event(t){if(this.m_is_start)if("Escape"==t)this.toggle_activate();else if(this.m_is_game_active)if("s"==t)this.m_module.game_add_monsters(this.m_game_ptr);else if("m"==t)this.m_map.toggle_active();else if("+"==t)this.m_map.scale_up();else if("-"==t)this.m_map.scale_down();else if(" "==t){const t=x(this.m_scene_canvas,this.m_mouse_event),e=this.point_to_world(t[0],t[1]);this.m_module.game_client_shift(this.m_game_ptr,e[0],e[1])}}update(){if(this.m_is_game_active){if(this.m_is_mouse_press&&this.m_mouse_event&&this.m_scene_canvas){const t=x(this.m_scene_canvas,this.m_mouse_event),e=this.point_to_world(t[0],t[1]);this.m_scene.click_position(this.m_module,this.m_game_ptr,e[0],e[1])}const t=performance.now(),e=(t-this.m_current_time)/1e3;this.m_current_time=t,this.m_module&&this.m_module.game_update(this.m_game_ptr,e),this.m_scene.get_cooldawns().update(e),this.m_scene.get_click_cursor().update(e),this.m_ui.update(e),this.m_ui.update_count_values(this.m_total_level_entities,this.m_scene.get_monsters().size)}this.draw_map()}draw_map(){this.m_map&&this.m_map.draw()}define_level(t,e,s){this.m_level_width=t,this.m_level_height=e,this.m_level_tile_size=s,this.m_scene=new b(this.m_level_width,this.m_level_height,this.m_level_tile_size),this.m_wtc_scale=50/this.m_level_tile_size,this.m_wtc_tfm.set_uniform_scale(this.m_wtc_scale)}define_navmesh(t,e,s){this.m_map=new c(this.m_map_ctx,this.m_wtc_tfm,this.m_level_tile_size,t,e,s)}define_total_tiles(t){}tile_delete(t){this.m_scene.delete_tile(t),this.scene_tile_delete(t)}tile_create(t,e,s,i){const _=t*this.m_level_tile_size,n=e*this.m_level_tile_size;this.m_scene.create_tile(_,n,s,i),this.scene_tile_create(_,n,s,i)}create_player(t,e){this.m_scene.set_player_id(t),this.m_scene.set_player_radius(e),this.scene_create_player(e)}create_monster(t,e){this.m_scene.set_monster_radius(t,e),this.scene_create_monster(t,e)}define_entity_changes(t,e,s,i,_){this.m_scene.set_entity_position(t,e,s),this.m_scene.set_entity_angle(t,i),this.m_scene.set_entity_move(t,_),this.m_scene.is_player(t)?this.scene_define_player_changes(e,s,i,_):this.scene_define_entity_changes(t,e,s,i,_)}remove_monster(t){this.m_scene.remove_monster(t),this.scene_remove_monster(t)}define_total_update_entities(t){this.m_total_level_entities=t}entity_start_action(t,e){this.scene_entity_start_action(t,e)}entity_finish_action(t,e){this.scene_entity_finish_action(t,e)}entity_start_cooldawn(t,e,s){this.m_scene.get_cooldawns().start_cooldawn(t,e,s),this.scene_entity_start_cooldawn(t,e,s)}debug_entity_walk_path(t,e){const s=new Float32Array(e.length);for(let t=0;t<s.length;t++)s[t]=e[t];this.debug_entity_trajectory(t,s)}debug_close_entity(t,e,s,i,_,n){this.debug_close_entity_pair(t,e,s,i,_,n)}debug_visible_quad(t,e,s,i){this.debug_player_visible_quad(t,e,s,i)}debug_neighborhood_quad(t,e,s,i){this.debug_player_neighborhood_quad(t,e,s,i)}}function q(t,e,s){if(s.get_active()){const i=Math.pow(Math.min(s.get_proportion(),1),.15);t.save(),t.lineWidth=1,t.fillStyle="rgba(232, 128, 51, 0.25)",t.strokeStyle=o,t.beginPath();const _=e.multiply_array(s.get_translation()),n=e.apply_scale(.5)*i;t.arc(_[0],_[1],n,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.fillStyle=o,t.arc(_[0],_[1],2,0,2*Math.PI),t.fill(),t.restore()}}function E(t,e,s){const i=e.multiply_array(s.get_translation()),_=e.apply_scale(s.get_tile_size()),n=s.get_type();t.save(),t.lineWidth=.2,t.fillStyle="rgb(192, 192, 192)",t.strokeStyle="rgb(152, 152, 152)",t.beginPath(),0==n?t.rect(i[0],i[1],_,_):2==n?t.rect(i[0]+_/2,i[1]+_/2,_/2,_/2):3==n?t.rect(i[0],i[1]+_/2,_/2,_/2):4==n?t.rect(i[0]+_/2,i[1],_/2,_/2):5==n?t.rect(i[0],i[1],_/2,_/2):6==n?t.rect(i[0],i[1]+_/2,_,_/2):7==n?t.rect(i[0],i[1],_/2,_):8==n?t.rect(i[0],i[1],_,_/2):9==n?t.rect(i[0]+_/2,i[1],_/2,_):10==n?(t.moveTo(i[0],i[1]),t.lineTo(i[0],i[1]+_),t.lineTo(i[0]+_/2,i[1]+_),t.lineTo(i[0]+_/2,i[1]+_/2),t.lineTo(i[0]+_,i[1]+_/2),t.lineTo(i[0]+_,i[1])):11==n?(t.moveTo(i[0],i[1]),t.lineTo(i[0],i[1]+_/2),t.lineTo(i[0]+_/2,i[1]+_/2),t.lineTo(i[0]+_/2,i[1]+_),t.lineTo(i[0]+_,i[1]+_),t.lineTo(i[0]+_,i[1])):12==n?(t.moveTo(i[0],i[1]),t.lineTo(i[0],i[1]+_),t.lineTo(i[0]+_,i[1]+_),t.lineTo(i[0]+_,i[1]+_/2),t.lineTo(i[0]+_/2,i[1]+_/2),t.lineTo(i[0]+_/2,i[1])):13==n&&(t.moveTo(i[0],i[1]+_/2),t.lineTo(i[0],i[1]+_),t.lineTo(i[0]+_,i[1]+_),t.lineTo(i[0]+_,i[1]),t.lineTo(i[0]+_/2,i[1]),t.lineTo(i[0]+_/2,i[1]+_/2)),t.fill(),t.stroke(),t.restore()}function I(t,e,i,_,n,m,a,r,h,o){t.save(),t.lineWidth=n,t.fillStyle=i.get_move()==s.NONE?a:i.get_move()==s.WALK?m:r,t.strokeStyle=h,t.beginPath();const l=i.get_tfm(),c=e.compose_tfms(l),d=c.multiply(0,0),u=i.get_radius(),g=c.apply_scale(u),p=c.multiply(u*Math.SQRT2,0),v=l.rotation();t.arc(d[0],d[1],g,v+Math.PI/4,2*Math.PI+v-Math.PI/4),t.lineTo(p[0],p[1]),t.fill(),o&&t.stroke(),t.restore();for(let[e,s]of _)t.save(),t.lineWidth=2,t.strokeStyle="rgba(255, 255, 255, 0.25)",t.beginPath(),t.arc(d[0],d[1],6,v,2*Math.PI*(1-s[1]/s[0])+v),t.stroke(),t.restore()}function F(t,e,s,i){I(t,e,s,i,1,"rgba(91, 128, 78, 0.5)",h,"rgba(91, 128, 78, 0.25)","rgb(74, 193, 33)",false)}function A(t,e,s,i){I(t,e,s,i,1,"rgba(196, 94, 45, 0.5)","rgba(196, 94, 45, 0.75)","rgba(196, 94, 45, 0.25)","rgb(226, 55, 27)",false)}function W(t,e,s){t.save(),t.lineWidth=1,t.strokeStyle="rgb(94, 178, 219)",t.beginPath();const i=s.length/2,_=e.multiply(s[0],s[1]);t.moveTo(_[0],_[1]);for(let _=1;_<i;_++){const i=e.multiply(s[2*_],s[2*_+1]);t.lineTo(i[0],i[1])}t.stroke(),t.restore(),t.save(),t.fillStyle="rgb(53, 129, 166)";for(let _=0;_<i;_++){t.beginPath();const i=e.multiply(s[2*_],s[2*_+1]);t.arc(i[0],i[1],2,0,2*Math.PI),t.fill()}t.restore()}function j(t,e,s){t.save(),t.lineWidth=1,t.strokeStyle="rgb(82, 209, 77)",t.beginPath();const i=s.length/4;for(let _=0;_<i;_++){const i=e.multiply(s[4*_],s[4*_+1]),n=e.multiply(s[4*_+2],s[4*_+3]);t.moveTo(i[0],i[1]),t.lineTo(n[0],n[1])}t.stroke(),t.restore()}function N(t,e,s,i,_){t.save(),t.lineWidth=_,t.strokeStyle=i,t.beginPath();const n=e.multiply(s[0],s[1]),m=e.multiply(s[2],s[3]);t.moveTo(n[0],n[1]),t.lineTo(m[0],n[1]),t.lineTo(m[0],m[1]),t.lineTo(n[0],m[1]),t.closePath(),t.stroke(),t.restore()}function O(t,e,s){N(t,e,s,"rgb(111, 156, 227)",1)}function C(t,e,s){N(t,e,s,"rgb(134, 227, 111)",1)}new class extends P{m_camera_position_x=0;m_camera_position_y=0;m_debug_trajectories=new Map;m_is_draw_visible_rect=!1;m_debug_visible_rect=new Float32Array(4);m_is_draw_neighborhood_rect=!1;m_debug_neighborhood_rect=new Float32Array(4);constructor(){super(),this.m_canvas_width=this.m_scene_canvas.width,this.m_canvas_height=this.m_scene_canvas.height,this.m_debug_trajectories.clear(),this.m_debug_pairs=new Array}start(){this.update_process()}point_to_world(t,e){return this.m_wtc_tfm.inverse().multiply(t,e)}scene_tile_delete(t){}scene_tile_create(t,e,s,i){}scene_create_player(t){}mouse_click(t,e,s,i){}scene_define_player_changes(t,e,s,i){this.m_camera_position_x=1*t+0*this.m_camera_position_x,this.m_camera_position_y=1*e+0*this.m_camera_position_y,this.m_wtc_tfm.set_translation(this.m_canvas_width/2-this.m_camera_position_x*this.m_wtc_scale,this.m_canvas_height/2-this.m_camera_position_y*this.m_wtc_scale)}scene_create_monster(t,e){}scene_define_entity_changes(t,e,s,i,_){}scene_remove_monster(t){}scene_entity_start_action(t,e){}scene_entity_finish_action(t,e){}scene_entity_start_cooldawn(t,e,s){}debug_entity_trajectory(t,e){this.m_debug_trajectories.set(t,e)}debug_close_entity_pair(t,e,s,i,_,n){this.m_debug_pairs.push(e),this.m_debug_pairs.push(s),this.m_debug_pairs.push(_),this.m_debug_pairs.push(n)}debug_player_visible_quad(t,e,s,i){this.m_debug_visible_rect[0]=t,this.m_debug_visible_rect[1]=e,this.m_debug_visible_rect[2]=s,this.m_debug_visible_rect[3]=i,this.m_is_draw_visible_rect=!0}debug_player_neighborhood_quad(t,e,s,i){this.m_debug_neighborhood_rect[0]=t,this.m_debug_neighborhood_rect[1]=e,this.m_debug_neighborhood_rect[2]=s,this.m_debug_neighborhood_rect[3]=i,this.m_is_draw_neighborhood_rect=!0}update_process(){this.m_debug_trajectories.clear(),this.m_debug_pairs.length=0,this.update(),this.draw_scene(),window.requestAnimationFrame(this.update_process.bind(this))}draw_scene(){var t,e,s;this.m_scene_ctx.clearRect(0,0,this.m_canvas_width,this.m_canvas_height),t=this.m_scene_ctx,e=this.m_scene_canvas.width,s=this.m_scene_canvas.height,t.save(),t.fillStyle="rgb(64, 64, 64)",t.fillRect(0,0,e,s),t.restore();const i=this.m_scene.get_level_tiles();for(let[t,e]of i)E(this.m_scene_ctx,this.m_wtc_tfm,e);const _=this.m_scene.get_click_cursor();q(this.m_scene_ctx,this.m_wtc_tfm,_);const n=this.m_scene.get_player();F(this.m_scene_ctx,this.m_wtc_tfm,n,this.m_scene.get_person_cooldawns(n.get_id()));const m=this.m_scene.get_monsters();for(let[t,e]of m)A(this.m_scene_ctx,this.m_wtc_tfm,e,this.m_scene.get_person_cooldawns(e.get_id()));for(let[t,e]of this.m_debug_trajectories)W(this.m_scene_ctx,this.m_wtc_tfm,e);j(this.m_scene_ctx,this.m_wtc_tfm,this.m_debug_pairs),this.m_is_draw_visible_rect&&O(this.m_scene_ctx,this.m_wtc_tfm,this.m_debug_visible_rect),this.m_is_draw_neighborhood_rect&&C(this.m_scene_ctx,this.m_wtc_tfm,this.m_debug_neighborhood_rect)}};
//# sourceMappingURL=module.js.map
